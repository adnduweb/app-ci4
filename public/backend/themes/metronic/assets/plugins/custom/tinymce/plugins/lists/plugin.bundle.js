(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}!function(){"use strict";var e,n,r=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=function(e){return function(n){return o=t(r=n),(null===r?"null":"object"===o&&(Array.prototype.isPrototypeOf(r)||r.constructor&&"Array"===r.constructor.name)?"array":"object"===o&&(String.prototype.isPrototypeOf(r)||r.constructor&&"String"===r.constructor.name)?"string":o)===e;var r,o}},i=function(e){return function(n){return t(n)===e}},u=o("string"),a=o("object"),s=o("array"),c=i("boolean"),f=i("function"),l=i("number"),d=function(){},m=function(t){return function(){return t}},p=function(t){return t},v=function(t,e){return t===e},g=function(t){return function(e){return!t(e)}},h=m(!1),y=m(!0),S=function(){return b},b={fold:function(t,e){return t()},isSome:h,isNone:y,getOr:n=p,getOrThunk:e=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:m(null),getOrUndefined:m(void 0),or:n,orThunk:e,map:S,each:d,bind:S,exists:h,forall:y,filter:function(){return S()},toArray:function(){return[]},toString:m("none()")},C=function t(e){var n=m(e),r=function(){return i},o=function(t){return t(e)},i={fold:function(t,n){return n(e)},isSome:y,isNone:h,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:r,orThunk:r,map:function(n){return t(n(e))},each:function(t){t(e)},bind:o,exists:o,forall:o,filter:function(t){return t(e)?i:b},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return i},N=C,O=S,L=function(t){return null==t?b:C(t)},T=Array.prototype.slice,w=Array.prototype.push,x=function(t,e){for(var n=t.length,r=new Array(n),o=0;o<n;o++){var i=t[o];r[o]=e(i,o)}return r},D=function(t,e){for(var n=0,r=t.length;n<r;n++){e(t[n],n)}},k=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];e(i,r)&&n.push(i)}return n},A=function(t,e,n){return D(t,(function(t,r){n=e(n,t,r)})),n},E=function(t,e,n){for(var r=0,o=t.length;r<o;r++){var i=t[r];if(e(i,r))return N(i);if(n(i,r))break}return O()},I=function(t,e){return E(t,e,h)},P=function(t,e){return function(t){for(var e=[],n=0,r=t.length;n<r;++n){if(!s(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);w.apply(e,t[n])}return e}(x(t,e))},B=function(t){var e=T.call(t,0);return e.reverse(),e},R=function(t,e){return e>=0&&e<t.length?N(t[e]):O()},M=function(t){return R(t,0)},U=function(t){return R(t,t.length-1)},_=function(){return _=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},_.apply(this,arguments)};var $,F=function(){return H(0,0)},H=function(t,e){return{major:t,minor:e}},j={nu:H,detect:function(t,e){var n=String(e).toLowerCase();return 0===t.length?F():function(t,e){var n=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.test(e))return r}}(t,e);if(!n)return{major:0,minor:0};var r=function(t){return Number(e.replace(n,"$"+t))};return H(r(1),r(2))}(t,n)},unknown:F},K=function(t,e){return function(t,e){for(var n=0;n<t.length;n++){var r=e(t[n],n);if(r.isSome())return r}return O()}(e.brands,(function(e){var n=e.brand.toLowerCase();return I(t,(function(t){var e;return n===(null===(e=t.brand)||void 0===e?void 0:e.toLowerCase())})).map((function(t){return{current:t.name,version:j.nu(parseInt(e.version,10),0)}}))}))},V=function(t,e){var n=String(e).toLowerCase();return I(t,(function(t){return t.search(n)}))},W=function(t,e){return-1!==t.indexOf(e)},Q=($=/^\s+|\s+$/g,function(t){return t.replace($,"")}),X=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,q=function(t){return function(e){return W(e,t)}},z=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(t){return W(t,"edge/")&&W(t,"chrome")&&W(t,"safari")&&W(t,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,X],search:function(t){return W(t,"chrome")&&!W(t,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(t){return W(t,"msie")||W(t,"trident")}},{name:"Opera",versionRegexes:[X,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:q("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:q("firefox")},{name:"Safari",versionRegexes:[X,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(t){return(W(t,"safari")||W(t,"mobile/"))&&W(t,"applewebkit")}}],Y=[{name:"Windows",search:q("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(t){return W(t,"iphone")||W(t,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:q("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:q("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:q("linux"),versionRegexes:[]},{name:"Solaris",search:q("sunos"),versionRegexes:[]},{name:"FreeBSD",search:q("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:q("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Z={browsers:m(z),oses:m(Y)},G="Edge",J="Chrome",tt="Opera",et="Firefox",nt="Safari",rt=function(t){var e=t.current,n=t.version,r=function(t){return function(){return e===t}};return{current:e,version:n,isEdge:r(G),isChrome:r(J),isIE:r("IE"),isOpera:r(tt),isFirefox:r(et),isSafari:r(nt)}},ot={unknown:function(){return rt({current:void 0,version:j.unknown()})},nu:rt,edge:m(G),chrome:m(J),ie:m("IE"),opera:m(tt),firefox:m(et),safari:m(nt)},it="Windows",ut="Android",at="Linux",st="Solaris",ct="FreeBSD",ft="ChromeOS",lt=function(t){var e=t.current,n=t.version,r=function(t){return function(){return e===t}};return{current:e,version:n,isWindows:r(it),isiOS:r("iOS"),isAndroid:r(ut),isOSX:r("OSX"),isLinux:r(at),isSolaris:r(st),isFreeBSD:r(ct),isChromeOS:r(ft)}},dt={unknown:function(){return lt({current:void 0,version:j.unknown()})},nu:lt,windows:m(it),ios:m("iOS"),android:m(ut),linux:m(at),osx:m("OSX"),solaris:m(st),freebsd:m(ct),chromeos:m(ft)},mt=function(t,e,n){var r=Z.browsers(),o=Z.oses(),i=e.bind((function(t){return K(r,t)})).orThunk((function(){return function(t,e){return V(t,e).map((function(t){var n=j.detect(t.versionRegexes,e);return{current:t.name,version:n}}))}(r,t)})).fold(ot.unknown,ot.nu),u=function(t,e){return V(t,e).map((function(t){var n=j.detect(t.versionRegexes,e);return{current:t.name,version:n}}))}(o,t).fold(dt.unknown,dt.nu),a=function(t,e,n,r){var o=t.isiOS()&&!0===/ipad/i.test(n),i=t.isiOS()&&!o,u=t.isiOS()||t.isAndroid(),a=u||r("(pointer:coarse)"),s=o||!i&&u&&r("(min-device-width:768px)"),c=i||u&&!s,f=e.isSafari()&&t.isiOS()&&!1===/safari/i.test(n),l=!c&&!s&&!f;return{isiPad:m(o),isiPhone:m(i),isTablet:m(s),isPhone:m(c),isTouch:m(a),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:m(f),isDesktop:m(l)}}(u,i,t,n);return{browser:i,os:u,deviceType:a}},pt=function(t){return window.matchMedia(t).matches},vt=function(t){var e,n=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return n||(n=!0,e=t.apply(null,r)),e}}((function(){return mt(navigator.userAgent,L(navigator.userAgentData),pt)})),gt=function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},ht={fromHtml:function(t,e){var n=(e||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||n.childNodes.length>1)throw console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return gt(n.childNodes[0])},fromTag:function(t,e){var n=(e||document).createElement(t);return gt(n)},fromText:function(t,e){var n=(e||document).createTextNode(t);return gt(n)},fromDom:gt,fromPoint:function(t,e,n){return L(t.dom.elementFromPoint(e,n)).map(gt)}},yt=function(t,e){return t.dom===e.dom},St=function(t,e){return n=t.dom,r=e.dom,function(t,e,n){return 0!=(t.compareDocumentPosition(e)&n)}(n,r,Node.DOCUMENT_POSITION_CONTAINED_BY);var n,r},bt=function(t,e){return vt().browser.isIE()?St(t,e):function(t,e){var n=t.dom,r=e.dom;return n!==r&&n.contains(r)}(t,e)},Ct=function(t,e){var n=t.dom;if(1!==n.nodeType)return!1;var r=n;if(void 0!==r.matches)return r.matches(e);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(e);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(e);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},Nt=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),Ot=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Lt=tinymce.util.Tools.resolve("tinymce.util.VK"),Tt=Object.keys,wt=function(t,e){for(var n=Tt(t),r=0,o=n.length;r<o;r++){var i=n[r];e(t[i],i)}},xt=function(t,e){var n={};return function(t,e,n,r){wt(t,(function(t,o){(e(t,o)?n:r)(t,o)}))}(t,e,function(t){return function(e,n){t[n]=e}}(n),d),n};"undefined"!=typeof window?window:Function("return this;")();var Dt,kt=function(t){return t.dom.nodeName.toLowerCase()},At=(Dt=1,function(t){return function(t){return t.dom.nodeType}(t)===Dt}),Et=function(t){return function(e){return At(e)&&kt(e)===t}},It=function(t,e){var n=t.dom;wt(e,(function(t,e){!function(t,e,n){if(!(u(n)||c(n)||l(n)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")}(n,e,t)}))},Pt=function(t){return A(t.dom.attributes,(function(t,e){return t[e.name]=e.value,t}),{})},Bt=function(t){return L(t.dom.parentNode).map(ht.fromDom)},Rt=function(t){return x(t.dom.childNodes,ht.fromDom)},Mt=function(t,e){var n=t.dom.childNodes;return L(n[e]).map(ht.fromDom)},Ut=function(t){return Mt(t,0)},_t=function(t){return Mt(t,t.dom.childNodes.length-1)},$t=function(t,e){Bt(t).each((function(n){n.dom.insertBefore(e.dom,t.dom)}))},Ft=function(t,e){t.dom.appendChild(e.dom)},Ht=function(t,e){D(e,(function(e){Ft(t,e)}))},jt=function(t){var e=t.dom;null!==e.parentNode&&e.parentNode.removeChild(e)},Kt=function(t){return function(t,e){return ht.fromDom(t.dom.cloneNode(e))}(t,!0)},Vt=function(t,e){var n=function(t,e){var n=ht.fromTag(e),r=Pt(t);return It(n,r),n}(t,e);$t(t,n);var r=Rt(t);return Ht(n,r),jt(t),n},Wt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Qt=tinymce.util.Tools.resolve("tinymce.util.Tools"),Xt=function(t){return function(e){return e&&e.nodeName.toLowerCase()===t}},qt=function(t){return function(e){return e&&t.test(e.nodeName)}},zt=function(t){return t&&3===t.nodeType},Yt=qt(/^(OL|UL|DL)$/),Zt=qt(/^(OL|UL)$/),Gt=Xt("ol"),Jt=qt(/^(LI|DT|DD)$/),te=qt(/^(DT|DD)$/),ee=qt(/^(TH|TD)$/),ne=Xt("br"),re=function(t,e){return e&&!!t.schema.getTextBlockElements()[e.nodeName]},oe=function(t,e){return t&&t.nodeName in e},ie=function(t,e,n){var r=t.isEmpty(e);return!(n&&t.select("span[data-mce-type=bookmark]",e).length>0)&&r},ue=function(t,e){return t.isChildOf(e,t.getRoot())},ae=function(t,e){var n,r,o,i=t.dom,u=t.schema.getBlockElements(),a=i.createFragment(),s=function(t){var e=t.getParam("forced_root_block","p");return!1===e?"":!0===e?"p":e}(t);if(s&&((r=i.create(s)).tagName===s.toUpperCase()&&i.setAttribs(r,function(t){return t.getParam("forced_root_block_attrs",{})}(t)),oe(e.firstChild,u)||a.appendChild(r)),e)for(;n=e.firstChild;){var c=n.nodeName;o||"SPAN"===c&&"bookmark"===n.getAttribute("data-mce-type")||(o=!0),oe(n,u)?(a.appendChild(n),r=null):s?(r||(r=i.create(s),a.appendChild(r)),r.appendChild(n)):a.appendChild(n)}return s?o||r.appendChild(i.create("br",{"data-mce-bogus":"1"})):a.appendChild(i.create("br")),a},se=Wt.DOM,ce=Et("dd"),fe=Et("dt"),le=function(t,e){ce(e)?Vt(e,"dt"):fe(e)&&Bt(e).each((function(n){return function(t,e,n){var r=se.select('span[data-mce-type="bookmark"]',e),o=ae(t,n),i=se.createRng();i.setStartAfter(n),i.setEndAfter(e);for(var u,a=i.extractContents(),s=a.firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&t.dom.isEmpty(s)){se.remove(s);break}t.dom.isEmpty(a)||se.insertAfter(a,e),se.insertAfter(o,e),ie(t.dom,n.parentNode)&&(u=n.parentNode,Qt.each(r,(function(t){u.parentNode.insertBefore(t,n.parentNode)})),se.remove(u)),se.remove(n),ie(t.dom,e)&&se.remove(e)}(t,n.dom,e.dom)}))},de=function(t){fe(t)&&Vt(t,"dd")},me=function(t,e){if(zt(t))return{container:t,offset:e};var n=Nt.getNode(t,e);return zt(n)?{container:n,offset:e>=t.childNodes.length?n.data.length:0}:n.previousSibling&&zt(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&zt(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:t,offset:e}},pe=function(t){var e=t.cloneRange(),n=me(t.startContainer,t.startOffset);e.setStart(n.container,n.offset);var r=me(t.endContainer,t.endOffset);return e.setEnd(r.container,r.offset),e},ve=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),ge=function(t,e){var n=e||t.selection.getStart(!0);return t.dom.getParent(n,"OL,UL,DL",Se(t,n))},he=function(t){var e=ge(t),n=t.selection.getSelectedBlocks();return function(t,e){return t&&1===e.length&&e[0]===t}(e,n)?function(t){return k(t.querySelectorAll("ol,ul,dl"),Yt)}(e):k(n,(function(t){return Yt(t)&&e!==t}))},ye=function(t){var e=t.selection.getSelectedBlocks();return k(function(t,e){var n=Qt.map(e,(function(e){return t.dom.getParent(e,"li,dd,dt",Se(t,e))||e}));return ve.unique(n)}(t,e),Jt)},Se=function(t,e){var n=t.dom.getParents(e,"TD,TH");return n.length>0?n[0]:t.getBody()},be=function(t,e){var n=t.dom.getParents(e,"ol,ul",Se(t,e));return U(n)},Ce=function(t){var e=function(t){var e=be(t,t.selection.getStart()),n=k(t.selection.getSelectedBlocks(),Zt);return e.toArray().concat(n)}(t);return Ne(t,e)},Ne=function(t,e){var n=x(e,(function(e){return be(t,e).getOr(e)}));return ve.unique(n)},Oe=function(t,e,n){return void 0===n&&(n=v),t.exists((function(t){return n(t,e)}))},Le=function(t,e,n){return t.isSome()&&e.isSome()?N(n(t.getOrDie(),e.getOrDie())):O()},Te=function(t,e,n){return t.fire("ListMutation",{action:e,element:n})},we=function(t,e,n){if(!u(n))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",n,":: Element ",t),new Error("CSS value must be a string: "+n);(function(t){return void 0!==t.style&&f(t.style.getPropertyValue)})(t)&&t.style.setProperty(e,n)},xe=function(t,e){Ft(t.item,e.list)},De=function(t,e){var n={list:ht.fromTag(e,t),item:ht.fromTag("li",t)};return Ft(n.list,n.item),n},ke=function(t,e,n){var r=e.slice(0,n.depth);return U(r).each((function(e){var r=function(t,e,n){var r=ht.fromTag("li",t);return It(r,e),Ht(r,n),r}(t,n.itemAttributes,n.content);!function(t,e){Ft(t.list,e),t.item=e}(e,r),function(t,e){kt(t.list)!==e.listType&&(t.list=Vt(t.list,e.listType)),It(t.list,e.listAttributes)}(e,n)})),r},Ae=function(t,e,n){var r,o=function(t,e,n){for(var r=[],o=0;o<n;o++)r.push(De(t,e.listType));return r}(t,n,n.depth-e.length);return function(t){for(var e=1;e<t.length;e++)xe(t[e-1],t[e])}(o),function(t,e){for(var n=0;n<t.length-1;n++)r=t[n].item,o="list-style-type",i="none",u=void 0,u=r.dom,we(u,o,i);var r,o,i,u;U(t).each((function(t){It(t.list,e.listAttributes),It(t.item,e.itemAttributes),Ht(t.item,e.content)}))}(o,n),r=o,Le(U(e),M(r),xe),e.concat(o)},Ee=function(t){return Ct(t,"OL,UL")},Ie=function(t){return Ut(t).exists(Ee)},Pe=function(t){return t.depth>0},Be=function(t){return t.isSelected},Re=function(t){var e=Rt(t),n=_t(t).exists(Ee)?e.slice(0,-1):e;return x(n,Kt)},Me=function(t){return D(t,(function(e,n){(function(t,e){var n=t[e].depth,r=function(t){return t.depth===n&&!t.dirty},o=function(t){return t.depth<n};return E(B(t.slice(0,e)),r,o).orThunk((function(){return E(t.slice(e+1),r,o)}))})(t,n).fold((function(){e.dirty&&function(t){t.listAttributes=xt(t.listAttributes,(function(t,e){return"start"!==e}))}(e)}),(function(t){return r=t,(n=e).listType=r.listType,void(n.listAttributes=_({},r.listAttributes));var n,r}))})),t},Ue=function(t,e,n,r){return Ut(r).filter(Ee).fold((function(){e.each((function(t){yt(t.start,r)&&n.set(!0)}));var o=function(t,e,n){return Bt(t).filter(At).map((function(r){return{depth:e,dirty:!1,isSelected:n,content:Re(t),itemAttributes:Pt(t),listAttributes:Pt(r),listType:kt(r)}}))}(r,t,n.get());e.each((function(t){yt(t.end,r)&&n.set(!1)}));var i=_t(r).filter(Ee).map((function(r){return _e(t,e,n,r)})).getOr([]);return o.toArray().concat(i)}),(function(r){return _e(t,e,n,r)}))},_e=function t(e,n,r,o){return P(Rt(o),(function(o){return(Ee(o)?t:Ue)(e+1,n,r,o)}))},$e=function(t,e){var n=Me(e);return x(n,(function(e){var n,r,o,i=(n=e.content,o=(r||document).createDocumentFragment(),D(n,(function(t){o.appendChild(t.dom)})),ht.fromDom(o));return ht.fromDom(ae(t,i.dom))}))},Fe=function(t,e){var n=Me(e);return function(t,e){var n=A(e,(function(e,n){return n.depth>e.length?Ae(t,e,n):ke(t,e,n)}),[]);return M(n).map((function(t){return t.list}))}(t.contentDocument,n).toArray()},He=function(t,e,n){var r=function(t,e){var n,r=(n=!1,{get:function(){return n},set:function(t){n=t}});return x(t,(function(t){return{sourceList:t,entries:_e(0,e,r,t)}}))}(e,function(t){var e=x(ye(t),ht.fromDom);return Le(I(e,g(Ie)),I(B(e),g(Ie)),(function(t,e){return{start:t,end:e}}))}(t));D(r,(function(e){!function(t,e){D(k(t,Be),(function(t){return function(t,e){switch(t){case"Indent":e.depth++;break;case"Outdent":e.depth--;break;case"Flatten":e.depth=0}e.dirty=!0}(e,t)}))}(e.entries,n);var r,o=function(t,e){return P(function(t,e){if(0===t.length)return[];for(var n=e(t[0]),r=[],o=[],i=0,u=t.length;i<u;i++){var a=t[i],s=e(a);s!==n&&(r.push(o),o=[]),n=s,o.push(a)}return 0!==o.length&&r.push(o),r}(e,Pe),(function(e){return M(e).exists(Pe)?Fe(t,e):$e(t,e)}))}(t,e.entries);D(o,(function(e){Te(t,"Indent"===n?"IndentList":"OutdentList",e.dom)})),r=e.sourceList,D(o,(function(t){$t(r,t)})),jt(e.sourceList)}))},je=function(t,e){var n=x(Ce(t),ht.fromDom),r=x(function(t){return k(ye(t),te)}(t),ht.fromDom),o=!1;if(n.length||r.length){var i=t.selection.getBookmark();He(t,n,e),function(t,e,n){D(n,"Indent"===e?de:function(e){return le(t,e)})}(t,e,r),t.selection.moveToBookmark(i),t.selection.setRng(pe(t.selection.getRng())),t.nodeChanged(),o=!0}return o},Ke=function(t){return je(t,"Indent")},Ve=function(t){return je(t,"Outdent")},We=function(t){return je(t,"Flatten")},Qe=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),Xe=Wt.DOM,qe=function(t){var e={},n=function(n){var r=t[n?"startContainer":"endContainer"],o=t[n?"startOffset":"endOffset"];if(1===r.nodeType){var i=Xe.create("span",{"data-mce-type":"bookmark"});r.hasChildNodes()?(o=Math.min(o,r.childNodes.length-1),n?r.insertBefore(i,r.childNodes[o]):Xe.insertAfter(i,r.childNodes[o])):r.appendChild(i),r=i,o=0}e[n?"startContainer":"endContainer"]=r,e[n?"startOffset":"endOffset"]=o};return n(!0),t.collapsed||n(),e},ze=function(t){var e=function(e){var n,r=n=t[e?"startContainer":"endContainer"],o=t[e?"startOffset":"endOffset"];r&&(1===r.nodeType&&(o=function(t){for(var e=t.parentNode.firstChild,n=0;e;){if(e===t)return n;1===e.nodeType&&"bookmark"===e.getAttribute("data-mce-type")||n++,e=e.nextSibling}return-1}(r),r=r.parentNode,Xe.remove(n),!r.hasChildNodes()&&Xe.isBlock(r)&&r.appendChild(Xe.create("br"))),t[e?"startContainer":"endContainer"]=r,t[e?"startOffset":"endOffset"]=o)};e(!0),e();var n=Xe.createRng();return n.setStart(t.startContainer,t.startOffset),t.endContainer&&n.setEnd(t.endContainer,t.endOffset),pe(n)},Ye=function(t){switch(t){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Ze=function(t){return/\btox\-/.test(t.className)},Ge=function(t,e,n){var r=function(t){var r=E(t.parents,Yt,ee).filter((function(t){return t.nodeName===e&&!Ze(t)})).isSome();n(r)},o=t.dom.getParents(t.selection.getNode());return r({parents:o}),t.on("NodeChange",r),function(){return t.off("NodeChange",r)}},Je=function(t,e){Qt.each(e,(function(e,n){t.setAttribute(n,e)}))},tn=function(t,e,n){!function(t,e,n){var r=n["list-style-type"]?n["list-style-type"]:null;t.setStyle(e,"list-style-type",r)}(t,e,n),function(t,e,n){Je(e,n["list-attributes"]),Qt.each(t.select("li",e),(function(t){Je(t,n["list-item-attributes"])}))}(t,e,n)},en=function(t,e,n,r){var o=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&ne(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(re(t,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},nn=function(t,e,n){var r=t.selection.getRng(),o="LI",i=Se(t,t.selection.getStart(!0)),u=t.dom;if("false"!==u.getContentEditable(t.selection.getNode())){"DL"===(e=e.toUpperCase())&&(o="DT");var a=qe(r),s=function(t,e,n){for(var r,o=[],i=t.dom,u=en(t,e,!0,n),a=en(t,e,!1,n),s=[],c=u;c&&(s.push(c),c!==a);c=c.nextSibling);return Qt.each(s,(function(e){if(re(t,e))return o.push(e),void(r=null);if(i.isBlock(e)||ne(e))return ne(e)&&i.remove(e),void(r=null);var u=e.nextSibling;Qe.isBookmarkNode(e)&&(Yt(u)||re(t,u)||!u&&e.parentNode===n)?r=null:(r||(r=i.create("p"),e.parentNode.insertBefore(r,e),o.push(r)),r.appendChild(e))})),o}(t,r,i);Qt.each(s,(function(r){var i,a=r.previousSibling,s=r.parentNode;Jt(s)||(a&&Yt(a)&&a.nodeName===e&&function(t,e,n){var r=t.getStyle(e,"list-style-type"),o=n?n["list-style-type"]:"";return r===(null===o?"":o)}(u,a,n)?(i=a,r=u.rename(r,o),a.appendChild(r)):(i=u.create(e),r.parentNode.insertBefore(i,r),i.appendChild(r),r=u.rename(r,o)),function(t,e,n){Qt.each(n,(function(n){var r;return t.setStyle(e,((r={})[n]="",r))}))}(u,r,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),tn(u,i,n),on(t.dom,i))})),t.selection.setRng(ze(a))}},rn=function(t,e,n){return function(t,e){return t&&e&&Yt(t)&&t.nodeName===e.nodeName}(e,n)&&function(t,e,n){return t.getStyle(e,"list-style-type",!0)===t.getStyle(n,"list-style-type",!0)}(t,e,n)&&(r=n,e.className===r.className);var r},on=function(t,e){var n,r;if(n=e.nextSibling,rn(t,e,n)){for(;r=n.firstChild;)e.appendChild(r);t.remove(n)}if(n=e.previousSibling,rn(t,e,n)){for(;r=n.lastChild;)e.insertBefore(r,e.firstChild);t.remove(n)}},un=function(t,e,n,r,o){var i=Yt(e);if(i&&e.nodeName===r&&!an(o))We(t);else{nn(t,r,o);var u=qe(t.selection.getRng()),a=i?function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([e],n,!0):n;Qt.each(a,(function(e){!function(t,e,n,r){if(e.nodeName!==n){var o=t.dom.rename(e,n);tn(t.dom,o,r),Te(t,Ye(n),o)}else tn(t.dom,e,r),Te(t,Ye(n),e)}(t,e,r,o)})),t.selection.setRng(ze(u))}},an=function(t){return"list-style-type"in t},sn=function(t,e,n){var r=ge(t),o=he(t),i=a(n)?n:{};o.length>0?un(t,r,o,e,i):function(t,e,n,r){if(e!==t.getBody())if(e)if(e.nodeName!==n||an(r)||Ze(e)){var o=qe(t.selection.getRng());tn(t.dom,e,r);var i=t.dom.rename(e,n);on(t.dom,i),t.selection.setRng(ze(o)),nn(t,n,r),Te(t,Ye(n),i)}else We(t);else nn(t,n,r),Te(t,Ye(n),e)}(t,r,e,i)},cn=Wt.DOM,fn=function(t,e){var n=Qt.grep(t.select("ol,ul",e));Qt.each(n,(function(e){!function(t,e){var n,r=e.parentNode;"LI"===r.nodeName&&r.firstChild===e&&((n=r.previousSibling)&&"LI"===n.nodeName?(n.appendChild(e),ie(t,r)&&cn.remove(r)):cn.setStyle(r,"listStyleType","none")),Yt(r)&&(n=r.previousSibling)&&"LI"===n.nodeName&&n.appendChild(e)}(t,e)}))},ln=function(t,e,n,r){var o=e.startContainer,i=e.startOffset;if(zt(o)&&(n?i<o.data.length:i>0))return o;var u=t.schema.getNonEmptyElements();1===o.nodeType&&(o=Nt.getNode(o,i));var a=new Ot(o,r);for(n&&function(t,e){return!!ne(e)&&t.isBlock(e.nextSibling)&&!ne(e.previousSibling)}(t.dom,o)&&a.next();o=a[n?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(u[o.nodeName])return o;if(zt(o)&&o.data.length>0)return o}},dn=function(t,e){var n=e.childNodes;return 1===n.length&&!Yt(n[0])&&t.isBlock(n[0])},mn=function(t,e,n){var r,o=dn(t,n)?n.firstChild:n;if(function(t,e){dn(t,e)&&t.remove(e.firstChild,!0)}(t,e),!ie(t,e,!0))for(;r=e.firstChild;)o.appendChild(r)},pn=function(t,e,n){var r,o=e.parentNode;if(ue(t,e)&&ue(t,n)){Yt(n.lastChild)&&(r=n.lastChild),o===n.lastChild&&ne(o.previousSibling)&&t.remove(o.previousSibling);var i=n.lastChild;i&&ne(i)&&e.hasChildNodes()&&t.remove(i),ie(t,n,!0)&&t.$(n).empty(),mn(t,e,n),r&&n.appendChild(r);var u=bt(ht.fromDom(n),ht.fromDom(e))?t.getParents(e,Yt,n):[];t.remove(e),D(u,(function(e){ie(t,e)&&e!==t.getRoot()&&t.remove(e)}))}},vn=function(t,e,n,r){var o=t.dom;if(o.isEmpty(r))!function(t,e,n){t.dom.$(n).empty(),pn(t.dom,e,n),t.selection.setCursorLocation(n,0)}(t,n,r);else{var i=qe(e);pn(o,n,r),t.selection.setRng(ze(i))}},gn=function(t,e){var n=t.dom,r=t.selection,o=r.getStart(),i=Se(t,o),u=n.getParent(r.getStart(),"LI",i);if(u){var a=u.parentNode;if(a===t.getBody()&&ie(n,a))return!0;var s=pe(r.getRng()),c=n.getParent(ln(t,s,e,i),"LI",i);if(c&&c!==u)return t.undoManager.transact((function(){var n;e?vn(t,s,c,u):(n=u).parentNode.firstChild===n?Ve(t):function(t,e,n,r){var o=qe(e);pn(t.dom,n,r);var i=ze(o);t.selection.setRng(i)}(t,s,u,c)})),!0;if(!c&&!e&&0===s.startOffset&&0===s.endOffset)return t.undoManager.transact((function(){We(t)})),!0}return!1},hn=function(t,e){return gn(t,e)||function(t,e){var n=t.dom,r=t.selection.getStart(),o=Se(t,r),i=n.getParent(r,n.isBlock,o);if(i&&n.isEmpty(i)){var u=pe(t.selection.getRng()),a=n.getParent(ln(t,u,e,o),"LI",o);if(a)return t.undoManager.transact((function(){!function(t,e,n){var r=t.getParent(e.parentNode,t.isBlock,n);t.remove(e),r&&t.isEmpty(r)&&t.remove(r)}(n,i,o),on(n,a.parentNode),t.selection.select(a,!0),t.selection.collapse(e)})),!0}return!1}(t,e)},yn=function(t,e){return t.selection.isCollapsed()?hn(t,e):function(t){var e=t.selection.getStart(),n=Se(t,e);return!!(t.dom.getParent(e,"LI,DT,DD",n)||ye(t).length>0)&&(t.undoManager.transact((function(){t.execCommand("Delete"),fn(t.dom,t.getBody())})),!0)}(t)},Sn=function(t){var e=B(Q(t).split("")),n=x(e,(function(t,e){var n=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,e)*n}));return A(n,(function(t,e){return t+e}),0)},bn=function t(e){if(--e<0)return"";var n=e%26;return t(Math.floor(e/26))+String.fromCharCode("A".charCodeAt(0)+n)},Cn=function(t){var e,n,r=ge(t);Gt(r)&&t.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:(e={start:t.dom.getAttrib(r,"start","1"),listStyleType:N(t.dom.getStyle(r,"list-style-type"))},n=parseInt(e.start,10),Oe(e.listStyleType,"upper-alpha")?bn(n):Oe(e.listStyleType,"lower-alpha")?bn(n).toLowerCase():e.start)},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(e){(function(t){switch(function(t){return/^[0-9]+$/.test(t)?2:/^[A-Z]+$/.test(t)?0:function(t){return/^[a-z]+$/.test(t)}(t)?1:t.length>0?4:3}(t)){case 2:return N({listStyleType:O(),start:t});case 0:return N({listStyleType:N("upper-alpha"),start:Sn(t).toString()});case 1:return N({listStyleType:N("lower-alpha"),start:Sn(t).toString()});case 3:return N({listStyleType:O(),start:""});case 4:return O()}})(e.getData().start).each((function(e){t.execCommand("mceListUpdate",!1,{attrs:{start:"1"===e.start?"":e.start},styles:{"list-style-type":e.listStyleType.getOr("")}})})),e.close()}})},Nn=function(t,e){return function(){var n=ge(t);return n&&n.nodeName===e}},On=function(t){t.addCommand("mceListProps",(function(){Cn(t)}))},Ln=function(t){t.on("BeforeExecCommand",(function(e){var n=e.command.toLowerCase();"indent"===n?Ke(t):"outdent"===n&&Ve(t)})),t.addCommand("InsertUnorderedList",(function(e,n){sn(t,"UL",n)})),t.addCommand("InsertOrderedList",(function(e,n){sn(t,"OL",n)})),t.addCommand("InsertDefinitionList",(function(e,n){sn(t,"DL",n)})),t.addCommand("RemoveList",(function(){We(t)})),On(t),t.addCommand("mceListUpdate",(function(e,n){a(n)&&function(t,e){var n=ge(t);t.undoManager.transact((function(){a(e.styles)&&t.dom.setStyles(n,e.styles),a(e.attrs)&&wt(e.attrs,(function(e,r){return t.dom.setAttrib(n,r,e)}))}))}(t,n)})),t.addQueryStateHandler("InsertUnorderedList",Nn(t,"UL")),t.addQueryStateHandler("InsertOrderedList",Nn(t,"OL")),t.addQueryStateHandler("InsertDefinitionList",Nn(t,"DL"))},Tn=function(t){(function(t){return t.getParam("lists_indent_on_tab",!0)})(t)&&function(t){t.on("keydown",(function(e){e.keyCode!==Lt.TAB||Lt.metaKeyPressed(e)||t.undoManager.transact((function(){(e.shiftKey?Ve(t):Ke(t))&&e.preventDefault()}))}))}(t),function(t){t.on("keydown",(function(e){e.keyCode===Lt.BACKSPACE?yn(t,!1)&&e.preventDefault():e.keyCode===Lt.DELETE&&yn(t,!0)&&e.preventDefault()}))}(t)};r.add("lists",(function(t){return!1===t.hasPlugin("rtc",!0)?(Tn(t),Ln(t)):On(t),function(t){var e=function(e){return function(){return t.execCommand(e)}};t.hasPlugin("advlist")||(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:e("InsertOrderedList"),onSetup:function(e){return Ge(t,"OL",e.setActive)}}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:e("InsertUnorderedList"),onSetup:function(e){return Ge(t,"UL",e.setActive)}}))}(t),function(t){var e={text:"List properties...",icon:"ordered-list",onAction:function(){return t.execCommand("mceListProps")},onSetup:function(e){return Ge(t,"OL",(function(t){return e.setDisabled(!t)}))}};t.ui.registry.addMenuItem("listprops",e),t.ui.registry.addContextMenu("lists",{update:function(e){var n=ge(t,e);return Gt(n)?["listprops"]:[]}})}(t),function(t){return{backspaceDelete:function(e){yn(t,e)}}}(t)}))}()})();