(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}!function(){"use strict";function n(n){return function(e){return o=t(r=e),(null===r?"null":"object"==o&&(Array.prototype.isPrototypeOf(r)||r.constructor&&"Array"===r.constructor.name)?"array":"object"==o&&(String.prototype.isPrototypeOf(r)||r.constructor&&"String"===r.constructor.name)?"string":o)===n;var r,o}}function e(n){return function(e){return t(e)===n}}function r(){}function o(t){return function(){return t}}function i(t){return t}function u(t,n){return t===n}function a(){return y}var l,c=tinymce.util.Tools.resolve("tinymce.PluginManager"),f=tinymce.util.Tools.resolve("tinymce.util.VK"),s=n("string"),m=n("array"),g=function(t){return l===t},d=e("boolean"),h=e("function"),p=o(!1),v=o(!(l=null)),y={fold:function(t,n){return t()},isSome:p,isNone:v,getOr:i,getOrThunk:k,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:o(null),getOrUndefined:o(void 0),or:i,orThunk:k,map:a,each:r,bind:a,exists:p,forall:v,filter:function(){return y},toArray:function(){return[]},toString:o("none()")};function k(t){return t()}function x(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!m(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);ot.apply(n,t[e])}return n}function b(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return et.none()}function O(t,n,e){return void 0===e&&(e=u),t.exists((function(t){return e(t,n)}))}function w(t,n){return t?et.some(n):et.none()}function C(t){var n=t.getParam("link_assume_external_targets",!1);return d(n)&&n?1:!s(n)||"http"!==n&&"https"!==n?0:n}function S(t){return t.getParam("default_link_target")}function N(t){return t.getParam("target_list",!0)}function A(t){return t.getParam("rel_list",[],"array")}function T(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")}function P(t){return s(t.value)?t.value:""}function _(t){return void 0===t&&(t=P),function(n){return et.from(n).map((function(n){return ut(n,t)}))}}function R(t,n){return ft.call(t,n)}function D(t){return t&&"a"===t.nodeName.toLowerCase()}function L(t){return D(t)&&!!gt(t)}function E(t,n){if(t.collapsed)return[];for(var e=t.cloneContents(),r=new st(e.firstChild,e),o=[],i=e.firstChild;n(i)&&o.push(i),i=r.next(););return o}function M(t){return/^\w+:/i.test(t)}function U(t,n){function e(t){return t.filter((function(t){return-1===it.inArray(o,t)}))}var r,o=["noopener"],i=t?t.split(/\s+/):[],u=n?0<(r=e(r=i)).length?r.concat(o):o:e(i);return 0<u.length?it.trim(u.sort().join(" ")):""}function B(t,n){return n=n||t.selection.getNode(),dt(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")}function I(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")}function K(t){return 0<it.grep(t,L).length}function z(t){var n=t.schema.getTextInlineElements();return 0===E(t.selection.getRng(),(function(t){return 1===t.nodeType&&!D(t)&&!R(n,t.nodeName.toLowerCase())})).length}function j(t,n,e){var o,i,u,a,l,c,f,s,m,d,h=(o=t,i=e.href,lt(lt({},e),{href:mt.isDomSafe(i,"a",o.settings)?i:""}));t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,(l=h.class,c=h.href,f=h.rel,s=h.target,m=h.text,d=h.title,function(t,n,e,r){(function(t){for(var o=ct(t),i=0,u=o.length;i<u;i++){var a=o[i];!function(t,o){(n(t,o)?e:r)(t,o)}(t[a],a)}})(t)}({class:l.getOrNull(),href:c,rel:f.getOrNull(),target:s.getOrNull(),text:m.getOrNull(),title:d.getOrNull()},(function(t,n){return!1===g(t)}),(u=a={},function(t,n){u[n]=t}),r),a)):function(t,n,e){var r,o,i,u,a,l,c,f=t.selection.getNode(),s=B(t,f),m=(o=t,i=function(t,n,e){return function(t){for(var r,o=0,i=t.length;o<i;o++)r=t[o],e=n(e,r,o)}(t),e}(["title","rel","class","target"],(function(t,n){return r[n].each((function(e){t[n]=0<e.length?e:null})),t}),{href:(r=e).href}),c=lt({},i),0<A(o).length||!1!==T(o)||(u=U(c.rel,"_blank"===c.target),c.rel=u||null),et.from(c.target).isNone()&&!1===N(o)&&(c.target=S(o)),c.href=(a=c.href,"http"!==(l=C(o))&&"https"!==l||M(a)?a:l+"://"+a),c);t.undoManager.transact((function(){var r,o,i,u,a,l,c,g;e.href===n.href&&n.attach(),s?(t.focus(),a=t,l=s,c=e.text,g=m,c.each((function(t){R(l,"innerText")?l.innerText=t:l.textContent=t})),a.dom.setAttribs(l,g),a.selection.select(l)):(r=t,i=e.text,u=m,dt(o=f)?pt(r,o,u):i.fold((function(){r.execCommand("mceInsertLink",!1,u)}),(function(t){r.insertContent(r.dom.createHTML("a",u,r.dom.encode(t)))})))}))}(t,n,h)}function V(t){var n;t.hasPlugin("rtc",!0)?t.execCommand("unlink"):(n=t).undoManager.transact((function(){var t,e,r,o,i,u,a,l=n.selection.getNode();dt(l)?ht(n,l):(e=(t=n).dom,o=(r=t.selection).getBookmark(),i=r.getRng().cloneRange(),u=e.getParent(i.startContainer,"a[href]",t.getBody()),a=e.getParent(i.endContainer,"a[href]",t.getBody()),u&&i.setStartBefore(u),a&&i.setEndAfter(a),r.setRng(i),t.execCommand("unlink"),r.moveToBookmark(o)),n.focus()}))}function q(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?et.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return lt(lt({},t),{href:"mailto:"+n})}}):et.none()}function F(t,n,e){var r=t.getAttrib(n,e);return null!==r&&0<r.length?et.some(r):et.none()}function W(t,n){return t.dom.getParent(n,"a[href]")}function H(t){return W(t,t.selection.getStart())}function G(t,n){var e,r;n&&(e=gt(n),/^#/.test(e)?(r=t.$(e)).length&&t.selection.scrollIntoView(r[0],!0):function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";var e,r,o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e=n,r=o,document.body.appendChild(e),e.dispatchEvent(r),document.body.removeChild(e)}(n.href))}function J(t){return function(){!function(t){var n,e=B(n=t);Ct(n,e).then((function(n){var e,o,i,u,a=i=t,l=(e=u=n).anchor.text.map((function(){return{name:"text",type:"input",label:"Text to display"}})).toArray(),c=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],f=et.from(S(a)),s=e.anchor,m={url:{value:o=s.url.getOr(""),meta:{original:{value:o}}},text:s.text.getOr(""),title:s.title.getOr(""),anchor:o,link:o,rel:s.rel.getOr(""),target:s.target.or(f).getOr(""),linkClass:s.linkClass.getOr("")},g=e.catalogs,d=yt(m,g);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:x([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],l,c,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([g.anchor.map(at.createUi("anchor","Anchors")),g.rels.map(at.createUi("rel","Rel")),g.targets.map(at.createUi("target","Open link in...")),g.link.map(at.createUi("link","Link list")),g.classes.map(at.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:m,onChange:function(t,n){var e=n.name;d.onChange(t.getData,{name:e}).each((function(n){t.setData(n)}))},onSubmit:function(t){var n=t.getData();if(!n.url.value)return V(i),void t.close();function e(t){return et.from(n[t]).filter((function(n){return!O(u.anchor[t],n)}))}var o={href:n.url.value,text:e("text"),target:e("target"),rel:e("rel"),class:e("linkClass"),title:e("title")},a={href:n.url.value,attach:void 0!==n.url.meta&&n.url.meta.attach?n.url.meta.attach:r};bt(i,o).then((function(t){j(i,a,t)})),t.close()}}})).then((function(n){t.windowManager.open(n)}))}(t)}}function X(t){return function(){G(t,H(t))}}function $(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}}function Q(t){return function(n){function e(){return n.setActive(!t.mode.isReadOnly()&&null!==B(t,t.selection.getNode()))}return e(),$(t,e)}}function Y(t){return function(n){function e(){return n.setDisabled(null===B(t,t.selection.getNode()))}return e(),$(t,e)}}function Z(t){return function(n){function e(n){return K(n)||0<E(t.selection.getRng(),L).length}var r=t.dom.getParents(t.selection.getStart());return n.setDisabled(!e(r)),$(t,(function(t){return n.setDisabled(!e(t.parents))}))}}function tt(t){var n=x(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i)}return r}(t.dom.select("a:not([href])"),(function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]})));return 0<n.length?et.some([{text:"None",value:""}].concat(n)):et.none()}var nt=function t(n){function e(){return u}function r(t){return t(n)}var i=o(n),u={fold:function(t,e){return e(n)},isSome:v,isNone:p,getOr:i,getOrThunk:i,getOrDie:i,getOrNull:i,getOrUndefined:i,or:e,orThunk:e,map:function(e){return t(e(n))},each:function(t){t(n)},bind:r,exists:r,forall:r,filter:function(t){return t(n)?u:y},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return u},et={some:nt,none:a,from:function(t){return null==t?y:nt(t)}},rt=Array.prototype.indexOf,ot=Array.prototype.push,it=tinymce.util.Tools.resolve("tinymce.util.Tools"),ut=function t(n,e){var r=[];return it.each(n,(function(n){var o,i,u,a=s((o=n).text)?o.text:s(o.title)?o.title:"";void 0!==n.menu?(i=t(n.menu,e),r.push({text:a,items:i})):(u=e(n),r.push({text:a,value:u}))})),r},at={sanitize:function(t){return _(P)(t)},sanitizeWith:_,createUi:function(t,n){return function(e){return{name:t,type:"listbox",label:n,items:e}}},getValue:P},lt=function(){return(lt=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},ct=Object.keys,ft=Object.hasOwnProperty,st=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),mt=tinymce.util.Tools.resolve("tinymce.util.URI"),gt=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},dt=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},ht=function(t,n){var e,r=t.dom.select("img",n)[0];!r||(e=t.dom.getParents(r,"a[href]",n)[0])&&(e.parentNode.insertBefore(r,e),t.dom.remove(e))},pt=function(t,n,e){var r,o=t.dom.select("img",n)[0];o&&(r=t.dom.create("a",e),o.parentNode.insertBefore(r,o),r.appendChild(o))},vt=function t(n,e){return b(e,(function(e){return R(r=e,"items")&&void 0!==r.items&&null!==r.items?t(n,e.items):w(e.value===n,e);var r}))},yt=function(t,n){function e(t,e){var i,u,a,l,c,f=("link"===(i=e.name)?n.link:"anchor"===i?n.anchor:et.none()).getOr([]);return u=o.text,a=f,l=t[e.name],c=0<u.length,void 0!==l?vt(l,a).map((function(t){return{url:{value:t.value,meta:{text:c?u:t.text,attach:r}},text:c?u:t.text}})):et.none()}var o={text:t.text,title:t.title};return{onChange:function(t,n){var r,i,u,a,l,c,f=n.name;return"url"===f?(u=(i=t()).url,l=w(o.text.length<=0,et.from(u.meta.text).getOr(u.value)),a=i.url,c=w(o.title.length<=0,et.from(a.meta.title).getOr("")),l.isSome()||c.isSome()?et.some(lt(lt({},l.map((function(t){return{text:t}})).getOr({})),c.map((function(t){return{title:t}})).getOr({}))):et.none()):(r=["anchor","link"],-1<rt.call(r,f)?e(t(),n):("text"!==f&&"title"!==f||(o[f]=t()[f]),et.none()))}}},kt=tinymce.util.Tools.resolve("tinymce.util.Delay"),xt=tinymce.util.Tools.resolve("tinymce.util.Promise"),bt=function(t,n){return b([q,(e=C(t),r=t.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!M(n)||0===e&&/^\s*www(\.|\d\.)/i.test(n)?et.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return lt(lt({},t),{href:r+"://"+n})}}):et.none()})],(function(t){return t(n)})).fold((function(){return xt.resolve(n)}),(function(e){return new xt((function(r){var o=t,i=e.message,u=o.selection.getRng();kt.setEditorTimeout(o,(function(){o.windowManager.confirm(i,(function(t){o.selection.setRng(u),function(t){r(t?e.preprocess(n):n)}(t)}))}))}))}));var e,r},Ot=tinymce.util.Tools.resolve("tinymce.util.XHR"),wt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Ct=function(t,n){return o=(r=t).getParam("link_list"),new xt((function(t){s(o)?Ot.send({url:o,success:function(n){return t(function(t){try{return et.some(JSON.parse(t))}catch(t){return et.none()}}(n))},error:function(n){return t(et.none())}}):h(o)?o((function(n){return t(et.some(n))})):t(et.from(o))})).then((function(t){return t.bind(at.sanitizeWith(e)).map((function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t}))})).then((function(e){var r,o,i,u,a,l,c,f,s,g,d=(o=n,i=(r=t).dom,u=z(r)?et.some(I(r.selection,o)):et.none(),a=o?et.some(i.getAttrib(o,"href")):et.none(),l=o?et.from(i.getAttrib(o,"target")):et.none(),c=F(i,o,"rel"),f=F(i,o,"class"),{url:a,text:u,title:F(i,o,"title"),target:l,rel:c,linkClass:f});return{anchor:d,catalogs:{targets:(g=N(t),m(g)?at.sanitize(g).orThunk((function(){return et.some(wt)})):!1===g?et.none():et.some(wt)),rels:function(t,n){var e=A(t);if(0<e.length){var r=O(n,"_blank");return(!1===T(t)?at.sanitizeWith((function(t){return U(at.getValue(t),r)})):at.sanitize)(e)}return et.none()}(t,d.target),classes:0<(s=t.getParam("link_class_list",[],"array")).length?at.sanitize(s):et.none(),anchor:tt(t),link:e},optNode:et.from(n),flags:{titleEnabled:t.getParam("link_title",!0,"boolean")}}}));function e(t){return r.convertURL(t.value||t.url,"href")}var r,o};c.add("link",(function(t){var n,e,o,i,u,a,l;function c(t){var n=l.selection.getNode();return t.setDisabled(!B(l,n)),r}(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:J(n),onSetup:Q(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:X(n),onSetup:Y(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return V(n)},onSetup:Z(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:X(e),onSetup:Y(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:J(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return V(e)},onSetup:Z(e)}),(o=t).ui.registry.addContextMenu("link",{update:function(t){return K(o.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),(l=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:Q(l)},label:"Link",predicate:function(t){return!!B(l,t)&&l.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=B(l);return t?gt(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=l.selection.getNode();return t.setActive(!!B(l,n)),Q(l)(t)},onAction:function(t){var n=t.getValue(),e=function(t){var n=B(l),e=z(l);if(n||!e)return et.none();var r=I(l.selection,n);return et.some(0<r.length?r:t)}(n);j(l,{href:n,attach:r},{href:n,text:e,title:et.none(),rel:et.none(),target:et.none(),class:et.none()}),l.selection.collapse(!1),t.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:c,onAction:function(t){V(l),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:c,onAction:function(t){X(l)(),t.hide()}}]}),(a=t).on("click",(function(t){var n=W(a,t.target);n&&f.metaKeyPressed(t)&&(t.preventDefault(),G(a,n))})),a.on("keydown",(function(t){var n=H(a);n&&13===t.keyCode&&!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey&&(t.preventDefault(),G(a,n))})),(i=t).addCommand("mceLink",(function(){i.getParam("link_quicklink",!1,"boolean")?i.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):J(i)()})),(u=t).addShortcut("Meta+K","",(function(){u.execCommand("mceLink")}))}))}()})();