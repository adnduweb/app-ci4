(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}!function(){"use strict";var n,e,r,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=tinymce.util.Tools.resolve("tinymce.util.VK"),u=function(n){return function(e){return o=t(r=e),(null===r?"null":"object"===o&&(Array.prototype.isPrototypeOf(r)||r.constructor&&"Array"===r.constructor.name)?"array":"object"===o&&(String.prototype.isPrototypeOf(r)||r.constructor&&"String"===r.constructor.name)?"string":o)===n;var r,o}},a=function(n){return function(e){return t(e)===n}},c=u("string"),l=u("array"),f=(n=null,function(t){return n===t}),s=a("boolean"),g=a("function"),m=function(){},d=function(t){return function(){return t}},h=function(t){return t},v=function(t,n){return t===n},p=d(!1),y=d(!0),k=function(){return x},x={fold:function(t,n){return t()},isSome:p,isNone:y,getOr:r=h,getOrThunk:e=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:d(null),getOrUndefined:d(void 0),or:r,orThunk:e,map:k,each:m,bind:k,exists:p,forall:y,filter:function(){return k()},toArray:function(){return[]},toString:d("none()")},b=function t(n){var e=d(n),r=function(){return i},o=function(t){return t(n)},i={fold:function(t,e){return e(n)},isSome:y,isNone:p,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:r,orThunk:r,map:function(e){return t(e(n))},each:function(t){t(n)},bind:o,exists:o,forall:o,filter:function(t){return t(n)?i:x},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return i},O=b,w=k,C=function(t){return null==t?x:b(t)},S=Array.prototype.indexOf,N=Array.prototype.push,A=function(t,n){return function(t,n){return S.call(t,n)}(t,n)>-1},T=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!l(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);N.apply(n,t[e])}return n},P=function(t,n){return T(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,n))},_=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return w()},R=function(t,n,e){return void 0===e&&(e=v),t.exists((function(t){return e(t,n)}))},D=function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n},L=function(t,n){return t?O(n):w()},E=function(t){var n=t.getParam("link_assume_external_targets",!1);return s(n)&&n?1:!c(n)||"http"!==n&&"https"!==n?0:n},M=function(t){return t.getParam("default_link_target")},U=function(t){return t.getParam("target_list",!0)},B=function(t){return t.getParam("rel_list",[],"array")},I=function(t){return t.getParam("link_title",!0,"boolean")},K=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},z=function(t){return t.getParam("link_default_protocol","http","string")},j=tinymce.util.Tools.resolve("tinymce.util.Tools"),V=function(t){return c(t.value)?t.value:""},q=function t(n,e){var r=[];return j.each(n,(function(n){var o=function(t){return c(t.text)?t.text:c(t.title)?t.title:""}(n);if(void 0!==n.menu){var i=t(n.menu,e);r.push({text:o,items:i})}else{var u=e(n);r.push({text:o,value:u})}})),r},F=function(t){return void 0===t&&(t=V),function(n){return C(n).map((function(n){return q(n,t)}))}},W={sanitize:function(t){return F(V)(t)},sanitizeWith:F,createUi:function(t,n){return function(e){return{name:t,type:"listbox",label:n,items:e}}},getValue:V},H=function(){return H=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t},H.apply(this,arguments)},G=Object.keys,J=Object.hasOwnProperty,X=function(t,n,e,r){return function(t,n){for(var e=G(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}}(t,(function(t,o){(n(t,o)?e:r)(t,o)})),{}},$=function(t,n){return J.call(t,n)},Q=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Y=tinymce.util.Tools.resolve("tinymce.util.URI"),Z=function(t){return t&&"a"===t.nodeName.toLowerCase()},tt=function(t){return Z(t)&&!!rt(t)},nt=function(t,n){if(t.collapsed)return[];var e=t.cloneContents(),r=new Q(e.firstChild,e),o=[],i=e.firstChild;do{n(i)&&o.push(i)}while(i=r.next());return o},et=function(t){return/^\w+:/i.test(t)},rt=function(t){var n=t.getAttribute("data-mce-href");return n||t.getAttribute("href")},ot=function(t,n){var e=["noopener"],r=t?t.split(/\s+/):[],o=function(t){return t.filter((function(t){return-1===j.inArray(e,t)}))},i=n?function(t){return(t=o(t)).length>0?t.concat(e):e}(r):o(r);return i.length>0?function(t){return j.trim(t.sort().join(" "))}(i):""},it=function(t,n){return n=n||t.selection.getNode(),lt(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},ut=function(t,n){return function(t){return t.replace(/\uFEFF/g,"")}(n?n.innerText||n.textContent:t.getContent({format:"text"}))},at=function(t){return j.grep(t,tt).length>0},ct=function(t){var n=t.schema.getTextInlineElements();return 0===nt(t.selection.getRng(),(function(t){return 1===t.nodeType&&!Z(t)&&!$(n,t.nodeName.toLowerCase())})).length},lt=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},ft=function(t,n){var e=H({},n);if(!(B(t).length>0)&&!1===K(t)){var r=ot(e.rel,"_blank"===e.target);e.rel=r||null}return C(e.target).isNone()&&!1===U(t)&&(e.target=M(t)),e.href=function(t,n){return"http"!==n&&"https"!==n||et(t)?t:n+"://"+t}(e.href,E(t)),e},st=function(t,n,e){var r=t.selection.getNode(),o=it(t,r),i=ft(t,function(t){var n,e,r;return n=["title","rel","class","target"],e=function(n,e){return t[e].each((function(t){n[e]=t.length>0?t:null})),n},r={href:t.href},function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)}(n,(function(t,n){r=e(r,t,n)})),r}(e));t.undoManager.transact((function(){e.href===n.href&&n.attach(),o?(t.focus(),function(t,n,e,r){e.each((function(t){$(n,"innerText")?n.innerText=t:n.textContent=t})),t.dom.setAttribs(n,r),t.selection.select(n)}(t,o,e.text,i)):function(t,n,e,r){lt(n)?vt(t,n,r):e.fold((function(){t.execCommand("mceInsertLink",!1,r)}),(function(n){t.insertContent(t.dom.createHTML("a",r,t.dom.encode(n)))}))}(t,r,e.text,i)}))},gt=function(t){var n=t.class,e=t.href,r=t.rel,o=t.target,i=t.text,u=t.title;return function(t,n){var e,r={};return X(t,n,(e=r,function(t,n){e[n]=t}),m),r}({class:n.getOrNull(),href:e,rel:r.getOrNull(),target:o.getOrNull(),text:i.getOrNull(),title:u.getOrNull()},(function(t,n){return!1===f(t)}))},mt=function(t,n,e){var r=function(t,n){var e=n.href;return H(H({},n),{href:Y.isDomSafe(e,"a",t.settings)?e:""})}(t,e);t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,gt(r)):st(t,n,r)},dt=function(t){t.hasPlugin("rtc",!0)?t.execCommand("unlink"):function(t){t.undoManager.transact((function(){var n=t.selection.getNode();lt(n)?ht(t,n):function(t){var n=t.dom,e=t.selection,r=e.getBookmark(),o=e.getRng().cloneRange(),i=n.getParent(o.startContainer,"a[href]",t.getBody()),u=n.getParent(o.endContainer,"a[href]",t.getBody());i&&o.setStartBefore(i),u&&o.setEndAfter(u),e.setRng(o),t.execCommand("unlink"),e.moveToBookmark(r)}(t),t.focus()}))}(t)},ht=function(t,n){var e=t.dom.select("img",n)[0];if(e){var r=t.dom.getParents(e,"a[href]",n)[0];r&&(r.parentNode.insertBefore(e,r),t.dom.remove(r))}},vt=function(t,n,e){var r=t.dom.select("img",n)[0];if(r){var o=t.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},pt=function(t){return $(n=t,e="items")&&void 0!==n[e]&&null!==n[e];var n,e},yt=function t(n,e){return _(e,(function(e){return pt(e)?t(n,e.items):L(e.value===n,e)}))},kt=function(t,n,e,r){var o=r[n],i=t.length>0;return void 0!==o?yt(o,e).map((function(n){return{url:{value:n.value,meta:{text:i?t:n.text,attach:m}},text:i?t:n.text}})):w()},xt=function(t,n){var e={text:t.text,title:t.title},r=function(t){var n,r=(n=t.url,L(e.text.length<=0,C(n.meta.text).getOr(n.value))),o=function(t){return L(e.title.length<=0,C(t.meta.title).getOr(""))}(t.url);return r.isSome()||o.isSome()?O(H(H({},r.map((function(t){return{text:t}})).getOr({})),o.map((function(t){return{title:t}})).getOr({}))):w()},o=function(t,r){var o,i,u=(o=n,i=r.name,"link"===i?o.link:"anchor"===i?o.anchor:w()).getOr([]);return kt(e.text,r.name,u,t)};return{onChange:function(t,n){var i=n.name;return"url"===i?r(t()):A(["anchor","link"],i)?o(t(),n):"text"===i||"title"===i?(e[i]=t()[i],w()):w()}}},bt=tinymce.util.Tools.resolve("tinymce.util.Delay"),Ot=tinymce.util.Tools.resolve("tinymce.util.Promise"),wt=function(t){var n=t.href;return n.indexOf("@")>0&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?O({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return H(H({},t),{href:"mailto:"+n})}}):w()},Ct=function(t,n){return function(e){var r=e.href;return 1===t&&!et(r)||0===t&&/^\s*www(\.|\d\.)/i.test(r)?O({message:"The URL you entered seems to be an external link. Do you want to add the required "+n+":// prefix?",preprocess:function(t){return H(H({},t),{href:n+"://"+r})}}):w()}},St=function(t,n){return _([wt,Ct(E(t),z(t))],(function(t){return t(n)})).fold((function(){return Ot.resolve(n)}),(function(e){return new Ot((function(r){!function(t,n,e){var r=t.selection.getRng();bt.setEditorTimeout(t,(function(){t.windowManager.confirm(n,(function(n){t.selection.setRng(r),e(n)}))}))}(t,e.message,(function(t){r(t?e.preprocess(n):n)}))}))}))},Nt=function(t){var n=t.dom.select("a:not([href])"),e=P(n,(function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]}));return e.length>0?O([{text:"None",value:""}].concat(e)):w()},At=function(t){var n=function(t){return t.getParam("link_class_list",[],"array")}(t);return n.length>0?W.sanitize(n):w()},Tt=tinymce.util.Tools.resolve("tinymce.util.XHR"),Pt=function(t){var n=function(n){return t.convertURL(n.value||n.url,"href")},e=function(t){return t.getParam("link_list")}(t);return new Ot((function(t){c(e)?Tt.send({url:e,success:function(n){return t(function(t){try{return O(JSON.parse(t))}catch(t){return w()}}(n))},error:function(n){return t(w())}}):g(e)?e((function(n){return t(O(n))})):t(C(e))})).then((function(t){return t.bind(W.sanitizeWith(n)).map((function(t){if(t.length>0){return[{text:"None",value:""}].concat(t)}return t}))}))},_t=function(t,n){var e=B(t);if(e.length>0){var r=R(n,"_blank");return(!1===K(t)?W.sanitizeWith((function(t){return ot(W.getValue(t),r)})):W.sanitize)(e)}return w()},Rt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Dt=function(t){var n=U(t);return l(n)?W.sanitize(n).orThunk((function(){return O(Rt)})):!1===n?w():O(Rt)},Lt=function(t,n,e){var r=t.getAttrib(n,e);return null!==r&&r.length>0?O(r):w()},Et=function(t,n){return Pt(t).then((function(e){var r=function(t,n){var e=t.dom,r=ct(t)?O(ut(t.selection,n)):w(),o=n?O(e.getAttrib(n,"href")):w(),i=n?C(e.getAttrib(n,"target")):w(),u=Lt(e,n,"rel"),a=Lt(e,n,"class");return{url:o,text:r,title:Lt(e,n,"title"),target:i,rel:u,linkClass:a}}(t,n);return{anchor:r,catalogs:{targets:Dt(t),rels:_t(t,r.target),classes:At(t),anchor:Nt(t),link:e},optNode:C(n),flags:{titleEnabled:I(t)}}}))},Mt=function(t){var n=function(t){var n=it(t);return Et(t,n)}(t);n.then((function(n){var e=function(t,n){return function(e){var r=e.getData();if(!r.url.value)return dt(t),void e.close();var o=function(t){return C(r[t]).filter((function(e){return!R(n.anchor[t],e)}))},i={href:r.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:m};St(t,i).then((function(n){mt(t,u,n)})),e.close()}}(t,n);return function(t,n,e){var r=t.anchor.text.map((function(){return{name:"text",type:"input",label:"Text to display"}})).toArray(),o=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=function(t,n){var e=t.anchor,r=e.url.getOr("");return{url:{value:r,meta:{original:{value:r}}},text:e.text.getOr(""),title:e.title.getOr(""),anchor:r,link:r,rel:e.rel.getOr(""),target:e.target.or(n).getOr(""),linkClass:e.linkClass.getOr("")}}(t,C(M(e))),u=t.catalogs,a=xt(i,u);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:T([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,o,D([u.anchor.map(W.createUi("anchor","Anchors")),u.rels.map(W.createUi("rel","Rel")),u.targets.map(W.createUi("target","Open link in...")),u.link.map(W.createUi("link","Link list")),u.classes.map(W.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:function(t,n){var e=n.name;a.onChange(t.getData,{name:e}).each((function(n){t.setData(n)}))},onSubmit:n}}(n,e,t)})).then((function(n){t.windowManager.open(n)}))},Ut=function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),function(t,n){document.body.appendChild(t),t.dispatchEvent(n),document.body.removeChild(t)}(n,e)},Bt=function(t,n){return t.dom.getParent(n,"a[href]")},It=function(t){return Bt(t,t.selection.getStart())},Kt=function(t,n){if(n){var e=rt(n);if(/^#/.test(e)){var r=t.$(e);r.length&&t.selection.scrollIntoView(r[0],!0)}else Ut(n.href)}},zt=function(t){return function(){Mt(t)}},jt=function(t){return function(){Kt(t,It(t))}},Vt=function(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}},qt=function(t){return function(n){var e=function(){return n.setActive(!t.mode.isReadOnly()&&null!==it(t,t.selection.getNode()))};return e(),Vt(t,e)}},Ft=function(t){return function(n){var e=function(){return n.setDisabled(null===it(t,t.selection.getNode()))};return e(),Vt(t,e)}},Wt=function(t){return function(n){var e=function(n){return at(n)||(e=t.selection.getRng(),nt(e,tt).length>0);var e},r=t.dom.getParents(t.selection.getStart());return n.setDisabled(!e(r)),Vt(t,(function(t){return n.setDisabled(!e(t.parents))}))}},Ht=function(t){var n=function(n){var e=t.selection.getNode();return n.setDisabled(!it(t,e)),m};t.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:qt(t)},label:"Link",predicate:function(n){return!!it(t,n)&&function(t){return t.getParam("link_context_toolbar",!1,"boolean")}(t)},initValue:function(){var n=it(t);return n?rt(n):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(n){var e=t.selection.getNode();return n.setActive(!!it(t,e)),qt(t)(n)},onAction:function(n){var e=n.getValue(),r=function(n){var e=it(t),r=ct(t);if(!e&&r){var o=ut(t.selection,e);return O(o.length>0?o:n)}return w()}(e);mt(t,{href:e,attach:m},{href:e,text:r,title:w(),rel:w(),target:w(),class:w()}),function(t){t.selection.collapse(!1)}(t),n.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:n,onAction:function(n){dt(t),n.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:n,onAction:function(n){jt(t)(),n.hide()}}]})};o.add("link",(function(t){!function(t){t.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:zt(t),onSetup:qt(t)}),t.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:jt(t),onSetup:Ft(t)}),t.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return dt(t)},onSetup:Wt(t)})}(t),function(t){t.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:jt(t),onSetup:Ft(t)}),t.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:zt(t)}),t.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return dt(t)},onSetup:Wt(t)})}(t),function(t){t.ui.registry.addContextMenu("link",{update:function(n){return at(t.dom.getParents(n,"a"))?"link unlink openlink":"link"}})}(t),Ht(t),function(t){t.on("click",(function(n){var e=Bt(t,n.target);e&&i.metaKeyPressed(n)&&(n.preventDefault(),Kt(t,e))})),t.on("keydown",(function(n){var e=It(t);e&&13===n.keyCode&&function(t){return!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey}(n)&&(n.preventDefault(),Kt(t,e))}))}(t),function(t){t.addCommand("mceLink",(function(){!function(t){return t.getParam("link_quicklink",!1,"boolean")}(t)?zt(t)():t.fire("contexttoolbar-show",{toolbarKey:"quicklink"})}))}(t),function(t){t.addShortcut("Meta+K","",(function(){t.execCommand("mceLink")}))}(t)}))}()})();