(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}!function(){"use strict";var n=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=function(){return(r=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function e(t,n,r){if(r||2===arguments.length)for(var e,o=0,a=n.length;o<a;o++)!e&&o in n||((e=e||Array.prototype.slice.call(n,0,o))[o]=n[o]);return t.concat(e||Array.prototype.slice.call(n))}function o(n){return function(r){return o=t(e=r),(null===e?"null":"object"==o&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==o&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":o)===n;var e,o}}function a(){}function i(t){return function(){return t}}function u(t){return t}function f(){return g}var c=o("string"),s=o("object"),l=o("array"),d=i(!1),m=i(!0),g={fold:function(t,n){return t()},isSome:d,isNone:m,getOr:u,getOrThunk:p,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:u,orThunk:p,map:f,each:a,bind:f,exists:d,forall:m,filter:function(){return g},toArray:function(){return[]},toString:i("none()")};function p(t){return t()}function h(t,n){return-1<x.call(t,n)}function v(t,n){for(var r=t.length,e=new Array(r),o=0;o<r;o++){var a=t[o];e[o]=n(a,o)}return e}function y(t,n){for(var r=0,e=t.length;r<e;r++)n(t[r],r)}function b(t,n){for(var r=[],e=0,o=t.length;e<o;e++){var a=t[e];n(a,e)&&r.push(a)}return r}function k(t,n,r){return function(t){for(var e,o=t.length-1;0<=o;o--)e=t[o],r=n(r,e,o)}(t),r}function O(t,n){for(var r=0,e=t.length;r<e;++r)if(!0!==n(t[r],r))return;return 1}var w=function t(n){function r(){return a}function e(t){return t(n)}var o=i(n),a={fold:function(t,r){return r(n)},isSome:m,isNone:d,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:r,orThunk:r,map:function(r){return t(r(n))},each:function(t){t(n)},bind:e,exists:e,forall:e,filter:function(t){return t(n)?a:g},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return a},C={some:w,none:f,from:function(t){return null==t?g:w(t)}},E=Array.prototype.slice,x=Array.prototype.indexOf,R=Object.keys,T=Object.hasOwnProperty;function S(t){var n=[],r=[];return y(t,(function(t){t.fold((function(t){n.push(t)}),(function(t){r.push(t)}))})),{errors:n,values:r}}function P(t){return"inline-command"===t.type||"inline-format"===t.type}function N(t){return"block-command"===t.type||"block-format"===t.type}function M(t){function n(n){return it.error({message:n,pattern:t})}function r(r,e,o){if(void 0===t.format)return void 0!==t.cmd?c(t.cmd)?it.value(o(t.cmd,t.value)):n(r+" pattern has non-string `cmd` parameter"):n(r+" pattern is missing both `format` and `cmd` parameters");var a=void 0;if(l(t.format)){if(!O(t.format,c))return n(r+" pattern has non-string items in the `format` array");a=t.format}else{if(!c(t.format))return n(r+" pattern has non-string `format` parameter");a=[t.format]}return it.value(e(a))}if(!s(t))return n("Raw pattern is not an object");if(!c(t.start))return n("Raw pattern is missing `start` parameter");if(void 0===t.end)return void 0!==t.replacement?c(t.replacement)?0===t.start.length?n("Replacement pattern has empty `start` parameter"):it.value({type:"inline-command",start:"",end:t.start,cmd:"mceInsertContent",value:t.replacement}):n("Replacement pattern has non-string `replacement` parameter"):0===t.start.length?n("Block pattern has empty `start` parameter"):r("Block",(function(n){return{type:"block-format",start:t.start,format:n[0]}}),(function(n,r){return{type:"block-command",start:t.start,cmd:n,value:r}}));if(!c(t.end))return n("Inline pattern has non-string `end` parameter");if(0===t.start.length&&0===t.end.length)return n("Inline pattern has empty `start` and `end` parameters");var e=t.start,o=t.end;return 0===o.length&&(o=e,e=""),r("Inline",(function(t){return{type:"inline-format",start:e,end:o,format:t}}),(function(t,n){return{type:"inline-command",start:e,end:o,cmd:t,value:n}}))}function A(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0}function B(t){return{inlinePatterns:b(t,P),blockPatterns:(n=b(t,N),r=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1},(e=E.call(n,0)).sort(r),e)};var n,r,e}function D(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=ut.console;r&&(r.error||r.log).apply(r,t)}function I(t){var n=t.getParam("forced_root_block","p");return!1===n?"":!0===n?"p":n}function j(t,n){return{container:t,offset:n}}function _(t){return t.nodeType===Node.TEXT_NODE}function U(t,n,r,e){void 0===e&&(e=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),e&&!r(n.startContainer)&&(_(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),_(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),gt(t,o,r),o!==a&&gt(t,a,r))}function L(t){return 0===t.start.length}function V(t,n){var r=C.from(t.dom.getParent(n.startContainer,t.dom.isBlock));return""===I(t)?r.orThunk((function(){return C.some(t.getBody())})):r}function W(t){return function(n){return t===n?-1:0}}function q(t,n,r){if(_(t)&&0<=n)return C.some(j(t,n));var e=mt(pt);return C.from(e.backwards(t,n,W(t),r)).map((function(t){return j(t.container,t.container.data.length)}))}function F(t,n,r){if(_(n)&&(r<0||r>n.data.length))return[];for(var e=[r],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){e.push(i);break}o=a}return o===t?e.reverse():[]}function G(t,n,r,e,o){return{start:F(t,n,r),end:F(t,e,o)}}function H(t,n){var r=n.slice(),e=r.pop(),o=r,a=C.some(t);return y(o,(function(t,n){a=function(t,n){return t.bind((function(t){return C.from(t.childNodes[n])}))}(a,t)})),a.bind((function(t){return _(t)&&(e<0||e>t.data.length)?C.none():C.some({node:t,offset:e})}))}function J(t,n){return H(t,n.start).bind((function(r){var e=r.node,o=r.offset;return H(t,n.end).map((function(t){var n=t.node,r=t.offset,a=document.createRange();return a.setStart(e,o),a.setEnd(n,r),a}))}))}function K(t,n,r){(function(t,n){if(_(t)&&t.length<=0)return C.some(j(t,0));var r=mt(pt);return C.from(r.forwards(t,0,W(t),n)).map((function(t){return j(t.container,0)}))})(n,n).each((function(e){var o=e.container;vt(o,r.start.length,n).each((function(r){var e=t.createRng();e.setStart(o,0),e.setEnd(r.container,r.offset),U(t,e,(function(t){return t===n}))}))}))}function X(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})}function z(t,n){var r=t.createRng();return r.setStartAfter(n.start),r.setEndBefore(n.end),r}function Q(t,n,r){var e=J(t.getRoot(),r).getOrDie("Unable to resolve path range"),o=e.startContainer,a=e.endContainer,i=0===e.endOffset?a:a.splitText(e.endOffset),u=0===e.startOffset?o:o.splitText(e.startOffset);return{prefix:n,end:i.parentNode.insertBefore(X(t,n+"-end"),i),start:u.parentNode.insertBefore(X(t,n+"-start"),u)}}function Y(t,n,r){gt(t,t.get(n.prefix+"-end"),r),gt(t,t.get(n.prefix+"-start"),r)}function Z(t,n,r){t.selection.setRng(r),"inline-format"===n.type?y(n.format,(function(n){t.formatter.apply(n)})):t.execCommand(n.cmd,!1,n.value)}function $(t,n,r){var e=t.selection.getRng();return!1===e.collapsed?[]:V(t,e).bind((function(o){var a=e.startOffset-(r?1:0);return kt(t,n,e.startContainer,a,o)})).fold((function(){return[]}),(function(t){return t.matches}))}function tt(t,n){var e,o,a,i,u,f,c;0!==n.length&&(e=t.dom,o=t.selection.getBookmark(),a=e,i=n,u=(new Date).getTime(),f="mce_textpattern_"+Math.floor(1e9*Math.random())+ ++yt+String(u),c=k(i,(function(t,n){var e=Q(a,f+"_end"+t.length,n.endRng);return t.concat([r(r({},n),{endMarker:e})])}),[]),y(k(c,(function(t,n){var e=c.length-t.length-1,o=L(n.pattern)?n.endMarker:Q(a,f+"_start"+e,n.startRng);return t.concat([r(r({},n),{startMarker:o})])}),[]),(function(n){function r(t){return t===h}var o,a,i,u,f,c,s,l,d,m,g,p,h=e.getParent(n.startMarker.start,e.isBlock);L(n.pattern)?(a=n.pattern,i=n.endMarker,u=r,f=z((o=t).dom,i),U(o.dom,f,u),Z(o,a,f)):(c=t,s=n.pattern,l=n.startMarker,d=n.endMarker,m=r,p=z(g=c.dom,d),U(g,z(g,l),m),U(g,p,m),Z(c,s,z(g,{prefix:l.prefix,start:l.end,end:d.start}))),Y(e,n.endMarker,r),Y(e,n.startMarker,r)})),t.selection.moveToBookmark(o))}function nt(t,n){var r=$(t,n.inlinePatterns,!0);0<r.length&&t.undoManager.transact((function(){tt(t,r)}))}function rt(t,n,r){for(var e=0;e<t.length;e++)if(r(t[e],n))return 1}function et(t,n){var r=[",",".",";",":","!","?"],e=[32];t.on("keydown",(function(r){13!==r.keyCode||st.modifierPressed(r)||!function(t,n){if(t.selection.isCollapsed()){var r=$(t,n.inlinePatterns,!1),e=function(t,n){var r=t.dom,e=t.selection.getRng();return V(t,e).filter((function(n){var e=I(t),o=""===e&&r.is(n,"body")||r.is(n,e);return null!==n&&o})).bind((function(t){var e,o=t.textContent,a=n,i=(e=o).replace("Â "," ");return function(t,n,r){for(var e=0,o=t.length;e<o;e++){var a=t[e];if(n(a))return C.some(a);if(r(a,e))break}return C.none()}(a,(function(t){return 0===e.indexOf(t.start)||0===i.indexOf(t.start)}),d).map((function(n){return lt.trim(o).length===n.start.length?[]:[{pattern:n,range:G(r.getRoot(),t,0,t,0)}]}))})).getOr([])}(t,n.blockPatterns);return(0<e.length||0<r.length)&&(t.undoManager.add(),t.undoManager.extra((function(){t.execCommand("mceInsertNewLine")}),(function(){var n,o,a;t.insertContent("\ufeff"),tt(t,r),n=t,0!==(o=e).length&&(a=n.selection.getBookmark(),y(o,(function(t){return o=(r=n).dom,a=(e=t).pattern,i=J(o.getRoot(),e.range).getOrDie("Unable to resolve path range"),V(r,i).each((function(t){"block-format"===a.type?function(t,n){var r,e=n.get(t);return l(e)&&(0<(r=e).length?C.some(r[0]):C.none()).exists((function(t){return T.call(t,"block")}))}(a.format,r.formatter)&&r.undoManager.transact((function(){K(r.dom,t,a),r.formatter.apply(a.format)})):"block-command"===a.type&&r.undoManager.transact((function(){K(r.dom,t,a),r.execCommand(a.cmd,!1,a.value)}))})),1;var r,e,o,a,i})),n.selection.moveToBookmark(a));var i=t.selection.getRng(),u=q(i.startContainer,i.startOffset,t.dom.getRoot());t.execCommand("mceInsertNewLine"),u.each((function(n){var r=n.container;"\ufeff"===r.data.charAt(n.offset-1)&&(r.deleteData(n.offset-1,1),gt(t.dom,r.parentNode,(function(n){return n===t.dom.getRoot()})))}))})),1)}}(t,n.get())||r.preventDefault()}),!0),t.on("keyup",(function(r){rt(e,r,(function(t,n){return t===n.keyCode&&!1===st.modifierPressed(n)}))&&nt(t,n.get())})),t.on("keypress",(function(e){rt(r,e,(function(t,n){return t.charCodeAt(0)===n.charCode}))&&ct.setEditorTimeout(t,(function(){nt(t,n.get())}))}))}!function(t){if(!l(t))throw new Error("cases must be an array");if(0===t.length)throw new Error("there must be at least one case");var n=[],r={};y(t,(function(e,o){var a=R(e);if(1!==a.length)throw new Error("one and only one name per case");var i=a[0],u=e[i];if(void 0!==r[i])throw new Error("duplicate key detected:"+i);if("cata"===i)throw new Error("cannot have a case named cata (sorry)");if(!l(u))throw new Error("case arguments must be an array");n.push(i),r[i]=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var a=r.length;if(a!==u.length)throw new Error("Wrong number of arguments to case "+i+". Expected "+u.length+" ("+u+"), got "+a);return{fold:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(n.length!==t.length)throw new Error("Wrong number of arguments to fold. Expected "+t.length+", got "+n.length);return n[o].apply(null,r)},match:function(t){var e=R(t);if(n.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+n.join(",")+"\nActual: "+e.join(","));if(!O(n,(function(t){return h(e,t)})))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+n.join(", "));return t[i].apply(null,r)},log:function(t){console.log(t,{constructors:n,constructor:i,params:r})}}}}))}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var ot=function t(n){return{isValue:m,isError:d,getOr:i(n),getOrThunk:i(n),getOrDie:i(n),or:function(r){return t(n)},orThunk:function(r){return t(n)},fold:function(t,r){return r(n)},map:function(r){return t(r(n))},mapError:function(r){return t(n)},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOptional:function(){return C.some(n)}}},at=function t(n){return{isValue:d,isError:m,getOr:u,getOrThunk:function(t){return t()},getOrDie:function(){return t=String(n),function(){throw new Error(t)}();var t},or:u,orThunk:function(t){return t()},fold:function(t,r){return t(n)},map:function(r){return t(n)},mapError:function(r){return t(r(n))},each:a,bind:function(r){return t(n)},exists:d,forall:m,toOptional:C.none}},it={value:ot,error:at,fromOption:function(t,n){return t.fold((function(){return at(n)}),ot)}},ut="undefined"!=typeof window?window:Function("return this;")(),ft=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],ct=tinymce.util.Tools.resolve("tinymce.util.Delay"),st=tinymce.util.Tools.resolve("tinymce.util.VK"),lt=tinymce.util.Tools.resolve("tinymce.util.Tools"),dt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),mt=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),gt=function t(n,r,e){var o;r&&n.isEmpty(r)&&!e(r)&&(o=r.parentNode,n.remove(r),t(n,o,e))},pt=dt.DOM,ht=function t(n,r,e){if(!_(n))return C.none();var o=n.textContent;if(0<=r&&r<=o.length)return C.some(j(n,r));var a=mt(pt);return C.from(a.backwards(n,r,W(n),e)).bind((function(n){var o=n.container.data;return t(n.container,r+o.length,e)}))},vt=function t(n,r,e){if(!_(n))return C.none();var o=n.textContent;if(r<=o.length)return C.some(j(n,r));var a=mt(pt);return C.from(a.forwards(n,r,W(n),e)).bind((function(n){return t(n.container,r-o.length,e)}))},yt=0,bt=function t(n,r,e,o){var a,i,u,f,c,s,l,d=r.start;return i=o.container,u=o.offset,a=d,f=function(t,n){var r=t.data.substring(0,n),e=r.lastIndexOf(a.charAt(a.length-1)),o=r.lastIndexOf(a);return-1!==o?o+a.length:-1!==e?e+1:-1},c=e,l=mt(n,(s=n,function(t){return s.isBlock(t)||h(["BR","IMG","HR","INPUT"],t.nodeName)||"false"===s.getContentEditable(t)})),C.from(l.backwards(i,u,f,c)).bind((function(o){if(o.offset>=d.length){var a=n.createRng();return a.setStart(o.container,o.offset-d.length),a.setEnd(o.container,o.offset),C.some(a)}var i=o.offset-d.length;return ht(o.container,i,e).map((function(t){var r=n.createRng();return r.setStart(t.container,t.offset),r.setEnd(o.container,o.offset),r})).filter((function(t){return t.toString()===d})).orThunk((function(){return t(n,r,e,j(o.container,0))}))}))},kt=function t(n,r,e,o,a){var i=n.dom;return q(e,o,i.getRoot()).bind((function(u){var f=i.createRng();f.setStart(a,0),f.setEnd(e,o);for(var c,s=f.toString(),l=0;l<r.length;l++){var d,m,g=r[l],p=g.end;if(c=void 0,d=(c=s).length-p.length,""===(m=p)||c.length>=m.length&&c.substr(d,d+m.length)===m){var h=r.slice();h.splice(l,1);var v=function(n,r,e){var o=n.dom,a=o.getRoot(),i=e.pattern,u=e.position.container,f=e.position.offset;return ht(u,f-e.pattern.end.length,r).bind((function(c){var s=G(a,c.container,c.offset,u,f);if(L(i))return C.some({matches:[{pattern:i,startRng:s,endRng:s}],position:c});var l=t(n,e.remainingPatterns,c.container,c.offset,r),d=l.getOr({matches:[],position:c}),m=d.position;return function(t,n,r,e,o,a){if(void 0===a&&(a=!1),0!==n.start.length||a)return q(r,e,o).bind((function(r){return bt(t,n,o,r).bind((function(t){if(a){if(t.endContainer===r.container&&t.endOffset===r.offset)return C.none();if(0===r.offset&&t.endContainer.textContent.length===t.endOffset)return C.none()}return C.some(t)}))}));var i=t.createRng();return i.setStart(r,e),i.setEnd(r,e),C.some(i)}(o,i,m.container,m.offset,r,l.isNone()).map((function(t){var n=G(a,t.startContainer,t.startOffset,t.endContainer,t.endOffset);return{matches:d.matches.concat([{pattern:i,startRng:n,endRng:s}]),position:j(t.startContainer,t.startOffset)}}))}))}(n,a,{pattern:g,remainingPatterns:h,position:u});if(v.isSome())return v}}return C.none()}))};n.add("textpattern",(function(t){var n,r,o,a=(n=function(){var n=t.getParam("textpattern_patterns",ft,"array");if(!l(n))return D("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]};var r=S(v(n,M));return y(r.errors,(function(t){return D(t.message,t.pattern),0})),B(r.values)}(),r=n,{get:function(){return r},set:function(t){r=t}});return et(t,a),o=a,{setPatterns:function(t){var n=S(v(t,M));if(0<n.errors.length){var r=n.errors[0];throw new Error(r.message+":\n"+JSON.stringify(r.pattern,null,2))}o.set(B(n.values))},getPatterns:function(){return e(e([],v(o.get().inlinePatterns,A),!0),v(o.get().blockPatterns,A),!0)}}}))}()})();