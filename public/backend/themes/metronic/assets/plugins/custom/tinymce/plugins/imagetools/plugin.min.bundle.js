(()=>{var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){"use strict";function n(t){var e=t;return{get:function(){return e},set:function(t){e=t}}}function r(t){return null!=t}function o(){}function i(t){return function(){return t}}function a(t){return t}function u(){return h}function c(t){return r=e(n=t),"array"==(null===n?"null":"object"==r&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":r);var n,r}var s,f=tinymce.util.Tools.resolve("tinymce.PluginManager"),l=tinymce.util.Tools.resolve("tinymce.util.Tools"),d=i(!(s="function")),m=i(!0),h={fold:function(t,e){return t()},isSome:d,isNone:m,getOr:a,getOrThunk:g,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:a,orThunk:g,map:u,each:o,bind:u,exists:d,forall:m,filter:function(){return h},toArray:function(){return[]},toString:i("none()")};function g(t){return t()}var p=function t(e){function n(){return a}function r(t){return t(e)}var o=i(e),a={fold:function(t,n){return n(e)},isSome:m,isNone:d,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:n,orThunk:n,map:function(n){return t(n(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?a:h},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return a},v={some:p,none:u,from:function(t){return null==t?h:p(t)}},y={},w={exports:y};function b(t,e){return j(document.createElement("canvas"),t,e)}function _(t){var e=b(t.width,t.height);return U(e).drawImage(t,0,0),e}function E(t){return new R((function(e,n){function r(){i.removeEventListener("load",a),i.removeEventListener("error",u)}var o=URL.createObjectURL(t),i=new Image,a=function(){r(),e(i)},u=function(){r(),n("Unable to load data of type "+t.type+": "+o)};i.addEventListener("load",a),i.addEventListener("error",u),i.src=o,i.complete&&setTimeout(a,0)}))}function T(t,n,r){return n=n||"image/png",function(t){return e(t)===s}(HTMLCanvasElement.prototype.toBlob)?new R((function(e,o){t.toBlob((function(t){t?e(t):o()}),n,r)})):S(t.toDataURL(n,r))}function x(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}function I(t,e){return function(t,e,n){for(var r=0,o=t.length;r<o;r++){var i=t[r];if(e(i,r))return v.some(i);if(n(i,r))break}return v.none()}(t,e,d)}!function(){var n=this,r=function(){var n,r,o,i={exports:{}};function a(){}function u(t){if("object"!=e(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],m(t,this)}function c(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,u._immediateFn((function(){var n,r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){try{n=r(t._value)}catch(n){return void f(e.promise,n)}s(e.promise,n)}else(1===t._state?s:f)(e.promise,t._value)}))):t._deferreds.push(e)}function s(t,n){try{if(n===t)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==e(n)||"function"==typeof n)){var r=n.then;if(n instanceof u)return t._state=3,t._value=n,void l(t);if("function"==typeof r)return void m((o=r,i=n,function(){o.apply(i,arguments)}),t)}t._state=1,t._value=n,l(t)}catch(n){f(t,n)}var o,i}function f(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&u._immediateFn((function(){t._handled||u._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;e<n;e++)c(t,t._deferreds[e]);t._deferreds=null}function d(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function m(t,e){var n=!1;try{t((function(t){n||(n=!0,s(e,t))}),(function(t){n||(n=!0,f(e,t))}))}catch(t){if(n)return;n=!0,f(e,t)}}n=i,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},o=setTimeout,u.prototype.catch=function(t){return this.then(null,t)},u.prototype.then=function(t,e){var n=new this.constructor(a);return c(this,new d(t,e,n)),n},u.all=function(t){var n=Array.prototype.slice.call(t);return new u((function(t,r){if(0===n.length)return t([]);for(var o=n.length,i=0;i<n.length;i++)!function i(a,u){try{if(u&&("object"==e(u)||"function"==typeof u)){var c=u.then;if("function"==typeof c)return c.call(u,(function(t){i(a,t)}),r),0}n[a]=u,0==--o&&t(n)}catch(u){r(u)}}(i,n[i])}))},u.resolve=function(t){return t&&"object"==e(t)&&t.constructor===u?t:new u((function(e){e(t)}))},u.reject=function(t){return new u((function(e,n){n(t)}))},u.race=function(t){return new u((function(e,n){for(var r=0,o=t.length;r<o;r++)t[r].then(e,n)}))},u._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){o(t,0)},u._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},u._setImmediateFn=function(t){u._immediateFn=t},u._setUnhandledRejectionFn=function(t){u._unhandledRejectionFn=t},n.exports?n.exports=u:r.Promise||(r.Promise=u);var h=i.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||h}};"object"==e(y)&&void 0!==w?w.exports=r():(n="undefined"!=typeof globalThis?globalThis:n||self).EphoxContactWrapper=r()}();var R=w.exports.boltExport,U=function(t){return t.getContext("2d")},j=function(t,e,n){return t.width=e,t.height=n,t},A=function(t){return new R((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){200===this.status&&e(this.response)},r.onerror=function(){var t;n(0===this.status?((t=new Error("No access to download image")).code=18,t.name="SecurityError",t):new Error("Error "+this.status+" downloading image"))},r.send()}))},S=function(t){return new R((function(e,n){(function(){var e=t.split(","),n=/data:([^;]+)/.exec(e[0]);if(!n)return v.none();for(var r=n[1],o=e[1],i=atob(o),a=i.length,u=Math.ceil(a/1024),c=new Array(u),s=0;s<u;++s){for(var f=1024*s,l=Math.min(1024+f,a),d=new Array(l-f),m=f,h=0;m<l;++h,++m)d[h]=i[m].charCodeAt(0);c[s]=new Uint8Array(d)}return v.some(new Blob(c,{type:r}))})().fold((function(){n("uri is not base64: "+t)}),e)}))},M=E,P=Array.prototype.indexOf,O=Object.keys;function L(t,e,n){function r(e,n){return t.then((function(t){return t.toDataURL(e||"image/png",n)}))}return{getType:i(e.type),toBlob:function(){return R.resolve(e)},toDataURL:i(n),toBase64:function(){return n.split(",")[1]},toAdjustedBlob:function(e,n){return t.then((function(t){return T(t,e,n)}))},toAdjustedDataURL:r,toAdjustedBase64:function(t,e){return r(t,e).then((function(t){return t.split(",")[1]}))},toCanvas:function(){return t.then(_)}}}function k(t,e){return T(t,e).then((function(e){return L(R.resolve(t),e,t.toDataURL())}))}function F(t,e){void 0===e&&(e=2);var n=Math.pow(10,e),r=Math.round(t*n);return Math.ceil(r/n)}function C(t,e,n){return void 0===n&&(n=!1),new R((function(r){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&r({status:o.status,blob:o.response})},o.open("GET",t,!0),o.withCredentials=n,function(t){for(var e,n=O(t),r=0,i=n.length;r<i;r++){var a=n[r];e=t[a],o.setRequestHeader(a,e)}}(e),o.responseType="blob",o.send()}))}function B(t){var e,n=(e=t,"ImageProxy HTTP error: "+I($,(function(t){return e===t.code})).fold(i("Unknown ImageProxy error"),(function(t){return t.message})));return R.reject(n)}function N(t){return I(V,(function(e){return e.type===t})).fold(i("Unknown service error"),(function(t){return t.message}))}function D(t){return t<200||300<=t}function H(t,e){var n,o,i,a={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e};return C((o=e,i=-1===(n=t).indexOf("?")?"?":"&",/[?&]apiKey=/.test(n)?n:n+i+"apiKey="+encodeURIComponent(o)),a).then((function(t){return D(t.status)?(n=t.status,"application/json"!==(null==(o=t.blob)?void 0:o.type)||400!==n&&403!==n&&404!==n&&500!==n?B(n):(e=o,new R((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=function(t){n(t)},r.readAsText(e)})).then((function(t){var e=function(t){return"ImageProxy Service error: "+function(t){try{return v.some(JSON.parse(t))}catch(t){return v.none()}}(t).bind((function(t){return e=function(t,e){return r(t)?t[e]:void 0},n=t,x(["error","type"],(function(t,r){n=e(n,t)})),o=n,v.from(o).map(N);var e,n,o})).getOr("Invalid JSON in service error message")}(t);return R.reject(e)})))):R.resolve(t.blob);var e,n,o}))}function z(t,e,n){return void 0===n&&(n=!1),e?H(t,e):C(t,{},n).then((function(t){return D(t.status)?B(t.status):R.resolve(t.blob)}))}function q(t){return e=t,new R((function(t){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})).then((function(e){return L(E(t).then((function(t){!function(t){URL.revokeObjectURL(t.src)}(t);var e=b(t.naturalWidth||t.width,t.naturalHeight||t.height);return U(e).drawImage(t,0,0),e})),t,e)}));var e}function W(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}}!function(t){if(!c(t))throw new Error("cases must be an array");if(0===t.length)throw new Error("there must be at least one case");var e=[],n={};x(t,(function(r,o){var i=O(r);if(1!==i.length)throw new Error("one and only one name per case");var a=i[0],u=r[a];if(void 0!==n[a])throw new Error("duplicate key detected:"+a);if("cata"===a)throw new Error("cannot have a case named cata (sorry)");if(!c(u))throw new Error("case arguments must be an array");e.push(a),n[a]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=n.length;if(i!==u.length)throw new Error("Wrong number of arguments to case "+a+". Expected "+u.length+" ("+u+"), got "+i);return{fold:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length!==t.length)throw new Error("Wrong number of arguments to fold. Expected "+t.length+", got "+e.length);return e[o].apply(null,n)},match:function(t){var r=O(t);if(e.length!==r.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+r.join(","));if(!function(t){for(var e,n=0,o=t.length;n<o;++n)if(!0!==(e=t[n],function(t,e){return-1<P.call(t,e)}(r,e)))return;return 1}(e))throw new Error("Not all branches were specified when using match. Specified: "+r.join(", ")+"\nRequired: "+e.join(", "));return t[a].apply(null,n)},log:function(t){console.log(t,{constructors:e,constructor:a,params:n})}}}}))}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var $=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],V=[{type:"not_found",message:"Failed to load image."},{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],G={fromHtml:function(t,e){var n=(e||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return W(n.childNodes[0])},fromTag:function(t,e){return W((e||document).createElement(t))},fromText:function(t,e){return W((e||document).createTextNode(t))},fromDom:W,fromPoint:function(t,e,n){return v.from(t.dom.elementFromPoint(e,n)).map(W)}};function J(t){return t.getParam("imagetools_proxy")}function K(t){function e(t){return/^[0-9\.]+px$/.test(t)}var n=t.style.width,r=t.style.height;return n||r?e(n)&&e(r)?{w:parseInt(n,10),h:parseInt(r,10)}:null:(n=t.width,r=t.height,n&&r?{w:parseInt(n,10),h:parseInt(r,10)}:null)}function X(t){return{w:t.naturalWidth,h:t.naturalHeight}}function Q(t){return e=G.fromDom(t),"img",n=function(t){return function(e){var n=t.dom;if(1!==n.nodeType)return!1;var r=n;if(void 0!==r.matches)return r.matches(e);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(e);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(e);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")}("img")},I(e.dom.childNodes,(function(t){return n(G.fromDom(t))})).map(G.fromDom);var e,n}function Y(t,e){return t.dom.is(e,"figure")}function Z(t,e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")}function tt(t,e){function n(e){return Z(t,e)&&(pt(t,e)||vt(t,e)||r(J(t)))}return Y(t,e)?Q(e).bind((function(t){return n(t.dom)?v.some(t.dom):v.none()})):n(e)?v.some(e):v.none()}function et(t,e){t.notificationManager.open({text:e,type:"error"})}function nt(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return null!==n&&Y(t,n)?Q(n):Z(t,e)?v.some(G.fromDom(e)):v.none()}function rt(t,e,n){var o=e.match(/(?:\/|^)(([^\/\?]+)\.(?:[a-z0-9.]+))(?:\?|$)/i);return r(o)?t.dom.encode(o[n]):null}function ot(t,e){if(vt(t,e))return z(e.src,null,(n=e,-1!==l.inArray(t.getParam("imagetools_credentials_hosts",[],"string[]"),new ht(n.src).host)));var n,r;if(pt(t,e))return(0===(r=e.src).indexOf("data:")?S:A)(r);var o=J(t);return z(o+(-1===o.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),t.getParam("api_key",t.getParam("imagetools_api_key","","string"),"string"),!1)}function it(t,e){var n,r,o=t.editorUpload.blobCache.getByUri(e.src);return o?mt.resolve(o.blob()):(n=t,r=e,v.from(n.getParam("imagetools_fetch_image",null,"function")).fold((function(){return ot(n,r)}),(function(t){return t(r)})))}function at(t){dt.clearTimeout(t.get())}function ut(t,e,n,o,i,a,u){return n.toBlob().then((function(c){var s,f,l,d=t.editorUpload.blobCache,m=a.src,h=e.type===c.type;return t.getParam("images_reuse_filename",!1,"boolean")&&(f=r(l=d.getByUri(m))?(m=l.uri(),s=l.name(),l.filename()):(s=rt(t,m,2),rt(t,m,1))),l=d.create({id:"imagetools"+gt++,blob:c,base64:n.toBase64(),uri:m,name:s,filename:h?f:void 0}),d.add(l),t.undoManager.transact((function(){t.$(a).on("load",(function e(){var n,r,u;t.$(a).off("load",e),t.nodeChanged(),o?t.editorUpload.uploadImagesAuto():(at(i),n=t,r=i,u=dt.setEditorTimeout(n,(function(){n.editorUpload.uploadImagesAuto()}),n.getParam("images_upload_timeout",3e4,"number")),r.set(u))})),u&&t.$(a).attr({width:u.w,height:u.h}),t.$(a).attr({src:l.blobUri()}).removeAttr("data-mce-src")})),l}))}function ct(t,e,n,r){return function(){return nt(t).fold((function(){et(t,"Could not find selected image")}),(function(o){return t._scanForImages().then((function(){return it(t,o.dom)})).then((function(i){return q(i).then(n).then((function(n){return ut(t,i,n,!1,e,o.dom,r)}))})).catch((function(e){et(t,e)}))}))}}function st(t,e,n){return function(){var r=nt(t).map((function(t){var e=K(t.dom);return e?{w:e.h,h:e.w}:null})).getOrNull();return ct(t,e,(function(t){return r=n,(e=t).toCanvas().then((function(t){return function(t,e,n){var r=(n<0?360+n:n)*Math.PI/180,o=t.width,i=t.height,a=Math.sin(r),u=Math.cos(r),c=F(Math.abs(o*u)+Math.abs(i*a)),s=F(Math.abs(o*a)+Math.abs(i*u)),f=b(c,s),l=U(f);return l.translate(c/2,s/2),l.rotate(r),l.drawImage(t,-o/2,-i/2),k(f,e)}(t,e.getType(),r)}));var e,r}),r)()}}function ft(t,e,n){return function(){return ct(t,e,(function(t){return r=n,(e=t).toCanvas().then((function(t){return function(t,e,n){var r=b(t.width,t.height),o=U(r);return"v"===n?(o.scale(1,-1),o.drawImage(t,0,-r.height)):(o.scale(-1,1),o.drawImage(t,-r.width,0)),k(r,e)}(t,e.getType(),r)}));var e,r}))()}}function lt(t,e){return function(){var n=nt(t),r=n.map((function(t){return X(t.dom)}));n.each((function(i){tt(t,i.dom).each((function(a){it(t,i.dom).then((function(i){var a={blob:i,url:URL.createObjectURL(i)};t.windowManager.open({title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:a}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(o){var i=o.getData().imagetools.blob;n.each((function(n){r.each((function(r){var o,a,u,c,s;o=t,a=e,u=n.dom,c=r,M(s=i).then((function(t){var e,n,r,o,i=X(t);return c.w===i.w&&c.h===i.h||K(u)&&(e=u,(n=i)&&(r=e.style.width,o=e.style.height,(r||o)&&(e.style.width=n.w+"px",e.style.height=n.h+"px",e.removeAttribute("data-mce-style")),r=e.width,o=e.height,(r||o)&&(e.setAttribute("width",String(n.w)),e.setAttribute("height",String(n.h))))),URL.revokeObjectURL(t.src),s})).then(q).then((function(t){return ut(o,s,t,!0,a,u)}))}))})),o.close()},onCancel:o,onAction:function(t,e){switch(e.name){case"save-state":e.value?t.enable("save"):t.disable("save");break;case"disable":t.disable("save"),t.disable("cancel");break;case"enable":t.enable("cancel")}}})}))}))}))}}"undefined"!=typeof window||Function("return this;")();var dt=tinymce.util.Tools.resolve("tinymce.util.Delay"),mt=tinymce.util.Tools.resolve("tinymce.util.Promise"),ht=tinymce.util.Tools.resolve("tinymce.util.URI"),gt=0,pt=function(t,e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new ht(n).host===t.documentBaseURI.host},vt=function(t,e){return-1!==l.inArray(t.getParam("imagetools_cors_hosts",[],"string[]"),new ht(e.src).host)};f.add("imagetools",(function(t){var e,r,o,i,a=n(0),u=n(null),c=t;l.each({mceImageRotateLeft:st(c,a,-90),mceImageRotateRight:st(c,a,90),mceImageFlipVertical:ft(c,a,"v"),mceImageFlipHorizontal:ft(c,a,"h"),mceEditImage:lt(c,a)},(function(t,e){c.addCommand(e,t)})),function(t){function e(e){return function(){return t.execCommand(e)}}function n(){return nt(t).exists((function(e){return tt(t,e.dom).isSome()}))}function r(t){function e(e){return t.setDisabled(!e)}return e(n()),o=o.concat([e]),function(){o=function(t){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];i!==e&&n.push(i)}return n}(o)}}var o=[];t.on("NodeChange",(function(){var t=n();x(o,(function(e){return e(t)}))})),t.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:e("mceImageRotateLeft"),onSetup:r}),t.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:e("mceImageRotateRight"),onSetup:r}),t.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:e("mceImageFlipVertical"),onSetup:r}),t.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:e("mceImageFlipHorizontal"),onSetup:r}),t.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:e("mceEditImage"),onSetup:r}),t.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image",onAction:e("mceImage")}),t.ui.registry.addContextMenu("imagetools",{update:function(n){return tt(t,n).map((function(t){return{text:"Edit image",icon:"edit-image",onAction:e("mceEditImage")}})).toArray()}})}(t),(e=t).ui.registry.addContextToolbar("imagetools",{items:e.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions"),predicate:function(t){return tt(e,t).isSome()},position:"node",scope:"node"}),o=a,i=u,(r=t).on("NodeChange",(function(t){var e=i.get(),n=tt(r,t.element);e&&!n.exists((function(t){return e.src===t.src}))&&(at(o),r.editorUpload.uploadImagesAuto(),i.set(null)),n.each(i.set)}))}))}()})();